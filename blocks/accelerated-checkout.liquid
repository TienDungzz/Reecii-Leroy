{%- doc -%}
  This block is used to display the accelerated checkout button.
  Intended for product-form.liquid block.

  @param {string} can_add_to_cart - Whether the product can be added to the cart
  @param form_obj - The form object

  @example
  {% content_for 'block', type: 'accelerated-checkout', id: 'accelerated-checkout', can_add_to_cart: can_add_to_cart, form_obj: form %}
{%- enddoc -%}

{% liquid
  assign product = closest.product
  if request.visual_preview_mode and product == blank
    assign product = collections.all.products.first
  endif
%}

{% capture agree_condition %}
  {%- if block.settings.agree_condition and block.settings.agree_condition_text != blank -%}
    <div class="spacing-style newsletter-form__checkbox"
      style="--padding-block-start: {{ block.settings.condition-padding-block-start }}px; --padding-block-end:{{- block.settings.condition-padding-block-end -}}px;--padding-inline-start: 0px;--padding-inline-end: 0px;"
    >
      {% assign checkbox_id = block.id | prepend: 'agree_condition-' %}
      {% render 'checkbox', label: block.settings.agree_condition_text, id: checkbox_id, name: checkbox_id, required: true %}
    </div>
  {%- endif -%}
{% endcapture %}

<div
  class="accelerated-checkout-block checkout--{{ block.settings.style_class }}"
  ref="acceleratedCheckoutButtonContainer"
  {{ block.shopify_attributes }}
  {% if request.visual_preview_mode %}
    data-shopify-visual-preview
  {% endif %}
  {% unless can_add_to_cart %}
    hidden
  {% endunless %}
>
  {% if product != blank and form_obj != blank %}
    {{ agree_condition }}
    {{ form_obj | payment_button }}
  {% endif %}
</div>

{% stylesheet %}
  .accelerated-checkout-block[data-shopify-visual-preview] {
    width: 300px;
  }

  more-payment-options-link {
    font-size: smaller;
  }

  more-payment-options-link a {
    --button-color: var(--color-primary);
  }

  more-payment-options-link a:hover {
    --button-color: var(--color-primary-hover);
  }

  .shopify-payment-button__more-options[aria-hidden='true'] {
    display: none;
  }

  /* Checkout Button */
  .accelerated-checkout-block.checkout--button-secondary button.shopify-payment-button__button--unbranded {
    --button-color: var(--color-primary);
    --button-background-color: transparent;
    --button-border-color: var(--color-primary);
    --button-border-width: 1px;
    --button-border-radius: 0;
    --button-padding-block-start: 10px;
    --button-padding-block-end: 10px;
  }

  .accelerated-checkout-block.checkout--button-secondary button.shopify-payment-button__button--unbranded:hover {
    --shadow-horizontal-offset: 0;
    --shadow-vertical-offset: 0;
    --button-color: var(--color-secondary-button-hover-text);
    --button-background-color: var(--color-secondary-button-hover-background);
    --button-border-color: var(--color-secondary-button-hover-border);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.accelerated_checkout",
  "tag": null,
  "settings": [
    {
      "type": "checkbox",
      "id": "agree_condition",
      "label": "t:settings.enable_conditions",
      "default": true,
      "info": "t:info.terms_conditions_info"
    },
    {
      "type": "inline_richtext",
      "id": "agree_condition_text",
      "label": "t:settings.condition_text",
      "default": "I agree with the terms and conditions",
      "visible_if": "{{ block.settings.agree_condition == true }}"
    },
    {
      "type": "range",
      "id": "condition-padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20,
      "visible_if": "{{ block.settings.agree_condition == true }}"
    },
    {
      "type": "range",
      "id": "condition-padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20,
      "visible_if": "{{ block.settings.agree_condition == true }}"
    },
    {
      "type": "header",
      "content": "t:settings.button"
    },
    {
      "type": "select",
      "id": "style_class",
      "label": "t:settings.style",
      "options": [
        {
          "value": "button",
          "label": "t:options.primary"
        },
        {
          "value": "button-secondary",
          "label": "t:options.secondary"
        }
      ],
      "default": "button-secondary"
    }
  ]
}
{% endschema %}
