{%- liquid
  assign bl_stts = block.settings
  assign text = bl_stts.text
  assign number = bl_stts.number
  assign scroll_reveal = settings.animations_reveal_on_scroll

  assign collapse = bl_stts.collapse
  assign collapse_default = bl_stts.collapse_default
  if collapse == true
    assign element = 'sidebar-collapse'
    if collapse_default == 'open'
      assign aria_expanded = 'true'
    else
      assign aria_expanded = 'false'
    endif
  else
    assign element = 'div'
  endif
-%}

<{{element}} class="blog-post__recent-posts blog-posts__sidebar-item">
  {% if text != blank %}
    <h3 class="blog-posts__sidebar-heading{% if scroll_reveal %} scroll-trigger animate--slide-in{% endif %}{% if collapse %} blog-posts__sidebar-collapse-button cursor-pointer{% endif %}">
      {{ text }}
    </h3>
  {%- elsif text == blank and collapse == true -%}
    <h3 class="blog-posts__sidebar-heading blog-posts__sidebar-collapse-button cursor-pointer">
      {{ 'content.sidebar.collapse' | t }}
    </h3>
  {% endif %}

  {% if collapse %}
    <div class="blog-posts__sidebar-collapse-content" aria-expanded="{{ aria_expanded }}">
  {% endif %}

  <ul class="blog-post__recent-posts-list list-unstyled" role="menu">
    {%- for article in blog.articles limit: number -%}
      <li class="blog-post__recent-posts-item{% if scroll_reveal %} scroll-trigger animate--slide-in{% endif %}" style="{% if scroll_reveal %}--animation-order: {{ forloop.index }};{% endif %}">
        <h6 class="blog-title">
          <a href="{{ article.url }}" class="link link-underline" aria-label="link">
            <span class="text">{{ article.title }}</span>
          </a>
        </h6>
        <em class="date m-0">{{ article.published_at | date: '%d %B %Y' }}</em>
      </li>
    {%- endfor -%}
  </ul>

  {% if collapse %}
    </div>
  {% endif %}
</{{element}}>

{%- stylesheet -%}
  .blog-post__recent-posts-item {
    padding-block: var(--padding-2xs) var(--padding-sm);
  }

  .blog-post__recent-posts-item .blog-title {
    margin-block: 0 var(--margin-2xs);
  }

  .blog-post__recent-posts-item :is(.blog-title, .date) {
    font-size: var(--body-xs-font-size);
    line-height: var(--body-xs-line-height);
  }
{%- endstylesheet -%}

{% schema %}
{
  "name": "Recent posts",
  "tag": null,
  "settings": [
    {
      "type": "checkbox",
      "id": "collapse",
      "label": "Collapse",
      "default": false
    },
    {
      "type": "select",
      "id": "collapse_default",
      "label": "Collapse style",
      "visible_if": "{{ block.settings.collapse == true }}",
      "options": [
        {
          "value": "open",
          "label": "Open by default"
        },
        {
          "value": "close",
          "label": "Close by default"
        }
      ],
      "default": "close"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Heading",
      "default": "<p>Recent posts</p>"
    },
    {
      "type": "range",
      "id": "number",
      "label": "Number of posts",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 3
    }
  ],
  "presets": [
    {
      "name": "Recent posts"
    }
  ]
}
{% endschema %}
