{% comment %} [START block.markup] {% endcomment %}
<div
  class="header-block header-block--{{ block.id }} grid__item dis-block{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
  style="--width-header-col: {{ block.settings.width_grid_item }}%;"
  {{ block.shopify_attributes }}
> 
    <div class="dis-flex f-wrap j-c-end j-c-center-mb" {% if block.blocks.size > 0 %}data-menu-tab{% endif %}>
        {% content_for 'blocks' %}
    </div>
</div>
{% javascript %}
  function setCookie(name, value, days) {
    let expires = "";
    if (days) {
      let date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + value + "; path=/" + expires;
  }

  function getCookie(name) {
    let matches = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
    return matches ? decodeURIComponent(matches[1]) : null;
  }

  function menuTab() {
    const menuTabs = document.querySelector('[data-menu-tab]');
    if (!menuTabs) return;

    document.addEventListener('click', (event) => {
      const target = event.target.closest('[data-menu-tab] a');
      if (!target) return;

      const activePage = target.dataset.loadPage;
      setCookie('page-url', activePage, 1);
    });

    const canonical = document.querySelector('[canonical-url]')?.getAttribute('canonical-url');
    let handlePageUrl = getCookie('page-url');
    let menuTabItem, logoTabItem, menuItem;

    console.log(handlePageUrl);

    if (window.location.pathname.includes('/pages/') && window.page_active && window.page_active !== handlePageUrl) {
      setCookie('page-url', window.page_active, 1);
      handlePageUrl = window.page_active;
    }
    if (handlePageUrl) {
      menuTabItem = document.querySelector(`[data-handle-page='${handlePageUrl}']`);
      logoTabItem = document.querySelector('.header__heading-link').setAttribute('data-logo-page', `${handlePageUrl}`);
      menuItem = document.querySelector(`[data-handle-page='${handlePageUrl}']~.header__inline-menu`).setAttribute('data-menu-page', `${handlePageUrl}`);
    } else {
      menuTabItem = document.querySelector('[data-handle-page].is-active');
      logoTabItem = document.querySelector('[data-logo-page].first');
      menuItem = document.querySelector('[data-menu-page].is-active');
    }

    const menuTab = menuTabItem?.closest('[data-menu-tab]');
    if (menuTab) {
      menuTab.querySelectorAll('[data-handle-page]').forEach(el => el.classList.remove('is-active'));
      logoTabItem?.parentElement?.querySelectorAll('[data-logo-page]').forEach(el => el.classList.remove('is-active'));
      menuItem?.parentElement?.querySelectorAll('[data-menu-page]').forEach(el => el.classList.remove('is-active'));
    }

    if (handlePageUrl) {
      logoTabItem?.classList.add('is-active');
      menuTabItem?.classList.add('is-active');
      menuItem?.classList.add('is-active');
    } else {
      document.querySelector('[data-handle-page]:nth-child(1)')?.classList.add('is-active');
      document.querySelector('[data-logo-page]:nth-child(1)')?.classList.add('is-active');
      document.querySelector('[data-menu-page]:nth-child(1)')?.classList.add('is-active');
    }
  }
  menuTab();

  function appendTabMenuToMainMenu() {
    const handle = getCookie('page-url') || window.page_active;
    if (!handle || handle === 'undefined') return;

    const tabMenu = document.querySelector(`[data-menu-page='${handle}']`);
    const mainMenu = document.querySelector('[data-main-menu]');

    if (tabMenu && mainMenu) {
      mainMenu.innerHTML = tabMenu.innerHTML;
      // const menuClone = tabMenu.cloneNode(true);
      // menuClone.style.display = 'block';
      // mainMenu.appendChild(menuClone);
    }
  }
  appendTabMenuToMainMenu();
{% endjavascript %}

{% comment %} [END block.markup] {% endcomment %}

{% comment %} [START block.preset] {% endcomment %}
{% schema %}
{
  "name": "Group: Multi site",
  "tag": null,
  "settings": [
    {
      "type": "range",
      "id": "width_grid_item",
      "min": 15,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:sections.header.settings.grid_item.label__1",
      "info": "t:sections.header.settings.grid_item.info",
      "default": 25
    }
  ],
  "blocks": [
    { "type": "menu-tab" }
  ],
  "presets": [
    { "name": "Group: Multi site" }
  ]
}
{% endschema %}
{% comment %} [END block.preset {% endcomment %}