{% liquid
    assign map_list_height = block.settings.map_list_height
    assign map_list_width = block.settings.map_list_width
    assign map_gap_desktop = block.settings.map_gap_desktop
    assign map_gap_mobile = block.settings.map_gap_mobile

    assign pl = block.settings.padding_left
    assign pr = block.settings.padding_right
    assign pt = block.settings.padding_top
    assign pb = block.settings.padding_bottom

    assign border_color = block.settings.border_color
    assign border_width = block.settings.border_width

    assign item_background = block.settings.item_background
%}

{%- capture attr -%}
style="
{% if pl != 0 %}--pl:{{ pl }}px;{% endif %}
{% if pt != 0 %}--pt:{{ pt }}px;{% endif %}
{% if pb != 0 %}--pb:{{ pb }}px;{% endif %}
{% if pr != 0 %}--pr:{{ pr }}px;{% endif %}
{% if map_list_height != 0 %}--map-list-height:{{ map_list_height }}px;{% endif %}
{% if map_list_width != 0 %}--map-list-width:{{ map_list_width }}px;{% endif %}
{% if map_gap_desktop != 0 %}--map-gap-desktop:{{ map_gap_desktop }}px;{% endif %}
{% if map_gap_mobile != 0 %}--map-gap-mobile:{{ map_gap_mobile }}px;{% endif %}
{% if border_color != 'none' %}--border-color:{{ border_color }};{% endif %}
{% if border_width != 0 %}--border-width:{{ border_width }}px;{% endif %}
{% if item_background != 'none' %}--item-background:{{ item_background }};{% endif %}
"
{%- endcapture -%}

<div class="storeLocator" {{ attr }}>
    <div class="storeLocator__left">
        <div class="storeLocator__list" style="--pr: {{ map_gap_desktop }}px;">
            {% content_for 'blocks' %}
        </div>
    </div>
    <div class="storeLocator__right">
        <div class="map" id="map"></div>
    </div>
</div>

{% stylesheet %}
    .storeLocator {
        display: flex;
        gap: var(--map-gap-desktop);
    }

    .storeLocator__item {
        padding: var(--pt) var(--pr) var(--pb) var(--pl);
        text-decoration: none;
        border-bottom: var(--border-width) solid var(--border-color);
        cursor: pointer;
    }

    .storeLocator__item:last-child {
        border-bottom: none;
    }

    .storeLocator__item.active,
    .storeLocator__item:hover {
        background-color: var(--item-background);
    }

    .storeLocator__left {
        width: var(--map-list-width);
        overflow-y: auto;
        height: var(--map-list-height);
    }

    /* Scrollbar */
    .storeLocator__left::-webkit-scrollbar {
        width: 4px;
    }

    .storeLocator__left::-webkit-scrollbar-track {
        background: #F8F8F8;
    }

    .storeLocator__left::-webkit-scrollbar-thumb {
        background: #51565A;
    }

    .shopify-block:has(.storeLocator__right) {
        width: 100%;
    }

    .storeLocator__right {
        flex: 1;
    }

    .storeLocator__right .map:after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: block;
        background: linear-gradient(to bottom, #fafafa 8%, #f8f8f8 60%);
        transform: translateY(-100%);
        z-index: 2;
    }

    .storeLocator__right .map.is-loading:after {
        animation: overlaySlide 1.2s ease forwards;
    }

    .storeLocator__right .map {
        position: relative;
        overflow: hidden;
    }

    .storeLocator__right .map,
    .storeLocator__right iframe {
        width: 100%;
        height: 100%;
    }

    @media screen and (max-width: 749px) {
        .storeLocator {
            gap: var(--map-gap-mobile);
            flex-direction: column;
        }

        .storeLocator__left {
            width: 100%;
        }

        .storeLocator__right {
            aspect-ratio: 1 / 1;
        }
    }

    @keyframes overlaySlide {
        25%, 75% {
            transform: translateY(0);
        }

        100% {
            transform: translateY(100%);
        }
    }
{% endstylesheet %}

{% javascript %}
  (function(){
    var root = document.querySelector('.storeLocator');
    if (!root) return;

    var items = root.querySelectorAll('.storeLocator__item');
    var mapEl = root.querySelector('#map');
    if (!mapEl || !items.length) return;

    function setActive(item){
      items.forEach(function(i){ i.classList.remove('active'); });
      item.classList.add('active');
    }

    function renderMapFrom(item){
      var html = item.getAttribute('data-map') || '';
      mapEl.classList.add('is-loading');
      mapEl.innerHTML = html;

      setTimeout(function(){
        mapEl.classList.remove('is-loading');
      }, 500);
    }

    items.forEach(function(item){
      item.addEventListener('click', function(e){
        e.preventDefault();
        setActive(item);
        renderMapFrom(item);
      });
    });

    // Initialize with first item
    var first = items[0];
    if (first) {
      setActive(first);
      renderMapFrom(first);
    }
  })();
{% endjavascript %}

{% schema %}
{
    "name": "Store Locator",
    "settings": [
        {
            "type": "header",
            "content": "t:content.layout"
        },
        {
            "type": "range",
            "id": "map_list_height",
            "label": "Map list height",
            "min": 400,
            "max": 1000,
            "step": 100,
            "unit": "px",
            "default": 600
        },
        {
            "type": "range",
            "id": "map_list_width",
            "label": "Map list width",
            "min": 200,
            "max": 1000,
            "step": 50,
            "unit": "px",
            "default": 350
        },
        {
            "type": "range",
            "id": "map_gap_desktop",
            "label": "Map gap desktop",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 14
        },
        {
            "type": "range",
            "id": "map_gap_mobile",
            "label": "Map gap mobile",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 10
        },
        {
            "type": "header",
            "content": "Item Style"
        },
        {
            "type": "color",
            "id": "border_color",
            "label": "Border color",
            "default": "#eeeeee"
        },
        {
            "type": "range",
            "id": "border_width",
            "label": "Border width",
            "min": 0,
            "max": 10,
            "step": 1,
            "unit": "px",
            "default": 1
        },
        {
            "type": "color",
            "id": "item_background",
            "label": "Item background",
            "default": "#f8f8f8"
        },
        {
            "type": "range",
            "id": "padding_left",
            "label": "Padding left",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 10
        },
        {
            "type": "range",
            "id": "padding_right",
            "label": "Padding right",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 10
        },
        {
            "type": "range",
            "id": "padding_top",
            "label": "Padding top",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 10
        },
        {
            "type": "range",
            "id": "padding_bottom",
            "label": "Padding bottom",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "px",
            "default": 10
        }
    ],
    "blocks": [
        { "type": "_store-locator-item" }
    ],
    "presets": [
        {
            "name": "Store Locator"
        }
    ]
}
{% endschema %}