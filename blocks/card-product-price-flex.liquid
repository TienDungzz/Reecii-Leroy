
{% assign card_product = block.settings.product %}

{%- if card_product and card_product != empty -%}
    <div class="card--block card-information" {{ block.shopify_attributes }}>
        {% render 'price', product: card_product, price_class: '', show_compare_at_price: true %}
        {%- if card_product.quantity_price_breaks_configured? -%}
          {% if card_product.variants.size == 1 and quick_add == 'bulk' %}
            {% liquid
              assign quantity_rule = card_product.selected_or_first_available_variant.quantity_rule
              assign has_qty_rules = false
              if quantity_rule.increment > 1 or quantity_rule.min > 1 or quantity_rule.max != null
                assign has_qty_rules = true
              endif
            %}
            <quantity-popover>
              <button class="card__information-volume-pricing-note card__information-volume-pricing-note--button card__information-volume-pricing-note--button-{{ settings.card_text_alignment }} quantity-popover__info-button--icon-only button button button--tertiary medium-hide small-hide">
                <span class="caption">{{ 'products.product.volume_pricing.note' | t }}</span>
              </button>
              <button class="card__information-volume-pricing-note card__information-volume-pricing-note--button card__information-volume-pricing-note--button-{{ settings.card_text_alignment }} quantity-popover__info-button--icon-with-label button button--tertiary large-up-hide">
                <span class="caption">{{ 'products.product.volume_pricing.note' | t }}</span>
              </button>
          {% else %}
            <div class="card__information-volume-pricing-note">
              <span class="caption">{{ 'products.product.volume_pricing.note' | t }}</span>
            </div>
          {% endif %}
          {% if card_product.variants.size == 1 and quick_add == 'bulk' %}
            <div
              class="global-settings-popup quantity-popover__info"
              tabindex="-1"
              hidden
              id="quantity-popover-info-{{ card_product.selected_or_first_available_variant.id }}"
            >
              {%- if has_qty_rules -%}
                <div class="quantity__rules caption no-js-hidden">
                  {%- if quantity_rule.increment > 1 -%}
                    <span class="divider">
                      {{- 'products.product.quantity.multiples_of' | t: quantity: quantity_rule.increment -}}
                    </span>
                  {%- endif -%}
                  {%- if quantity_rule.min > 1 -%}
                    <span class="divider">
                      {{- 'products.product.quantity.min_of' | t: quantity: quantity_rule.min -}}
                    </span>
                  {%- endif -%}
                  {%- if quantity_rule.max != null -%}
                    <span class="divider">
                      {{- 'products.product.quantity.max_of' | t: quantity: quantity_rule.max -}}
                    </span>
                  {%- endif -%}
                </div>
              {%- endif -%}
              <button
                class="button-close button button--tertiary large-up-hide"
                type="button"
                aria-label="{{ 'accessibility.close' | t }}"
              >
                {{- 'icon-close.svg' | inline_asset_content -}}
              </button>
              {%- if card_product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                <volume-pricing class="parent-display">
                  <ul class="list-unstyled">
                    <li>
                      <span>{{ card_product.selected_or_first_available_variant.quantity_rule.min }}+</span>
                      {%- assign price = card_product.selected_or_first_available_variant.price
                        | money_with_currency
                      -%}
                      <span>{{ 'sections.quick_order_list.each' | t: money: price }}</span>
                    </li>
                    {%- for price_break in card_product.selected_or_first_available_variant.quantity_price_breaks -%}
                      <li>
                        <span>
                          {{- price_break.minimum_quantity -}}
                          <span aria-hidden="true">+</span></span
                        >
                        {%- assign price = price_break.price | money_with_currency -%}
                        <span> {{ 'sections.quick_order_list.each' | t: money: price }}</span>
                      </li>
                    {%- endfor -%}
                  </ul>
                </volume-pricing>
              {%- endif -%}
            </div>
            </quantity-popover>
          {% endif %}
        {%- endif -%}
    </div>
{%- else -%}
    <div class="card--block-price card-information thinhhihi" {{ block.shopify_attributes }}>
        {% render 'price', show_compare_at_price: true %}
    </div>
{%- endif -%}

{% schema %}
    {
        "name": "Product price",
        "tag": null,
        "settings": [
            {
                "type": "product",
                "id": "product",
                "label": "t:sections.collage.blocks.product.settings.product.label"
            }
        ],
        "presets": [
            {
                "name": "Product price",
                "settings": {
                    "product": "{{ closest.product }}"
                }
            }
        ]
    }
{% endschema %}
