{%- liquid
    assign products = block.settings.collection.products | default: (1..block.settings.columns_desktop)

    assign products_to_display = block.settings.collection.all_products_count
  
    if block.settings.collection.all_products_count > block.settings.products_to_show
      assign products_to_display = block.settings.products_to_show
      assign more_in_collection = true
    endif
  
    assign columns_mobile_int = section.settings.columns_mobile | plus: 0
    assign show_mobile_slider = false
    if section.settings.swipe_on_mobile and products_to_display > columns_mobile_int
      assign show_mobile_slider = true
    endif
  
    assign show_desktop_slider = false
    if section.settings.enable_desktop_slider and products_to_display > block.settings.columns_desktop
      assign show_desktop_slider = true
    endif
  
    assign columns_tablet = 2
    if block.settings.columns_desktop == 1
      assign columns_tablet = 1
    endif
-%}

<slider-component class="slider-mobile-gutter{% if section.settings.full_width %} slider-component-full-width{% endif %}{% if show_mobile_slider == false %} page-width{% endif %}{% if show_desktop_slider %} slider-component-desktop{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
    <ul
      id="Slider-{{ section.id }}"
      data-id="{{ section.id }}"
      class="grid product-grid contains-card contains-card--product{% if settings.card_style == 'standard' %} contains-card--standard{% endif %} grid--{{ block.settings.columns_desktop }}-col-desktop grid--{{ columns_tablet }}-col-tablet-down grid--{{ section.settings.columns_mobile }}-col-mobile{% if show_mobile_slider or show_desktop_slider %} slider{% if show_desktop_slider %} slider--desktop{% endif %}{% if show_mobile_slider %} slider--tablet grid--peek{% endif %}{% endif %}"
      role="list"
      aria-label="{{ 'general.slider.name' | t }}"
    >
      {% for product in products limit: block.settings.products_to_show %}
        <li id="Slide-{{ block.id }}-{{ forloop.index }}" class="grid__item{% if show_mobile_slider or show_desktop_slider or show_tablet_slider %} slider__slide{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
            {% if settings.animations_reveal_on_scroll %} data-cascade style="--animation-order: {{ forloop.index }};"{% endif %}
        >
            {% content_for "block", type: "card-product-flex", id: "product-slide-item", closest.product: product %}
        </li>
    {% endfor %}
    </ul>
    {%- if show_mobile_slider or show_desktop_slider -%}
      <div class="slider-buttons">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'general.slider.previous_slide' | t }}"
          aria-controls="Slider-{{ section.id }}"
        >
          <span class="svg-wrapper">
            {{- 'icon-caret.svg' | inline_asset_content -}}
          </span>
        </button>
        <div class="slider-counter caption">
          <span class="slider-counter--current">1</span>
          <span aria-hidden="true"> / </span>
          <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
          <span class="slider-counter--total">{{ products_to_display }}</span>
        </div>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'general.slider.next_slide' | t }}"
          aria-controls="Slider-{{ section.id }}"
        >
          <span class="svg-wrapper">
            {{- 'icon-caret.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>
    {%- endif -%}
</slider-component>

  {%- if block.settings.quick_add != 'none' -%}
    {%- liquid
      assign files = 'product-form.js'
  
      if block.settings.quick_add == 'standard'
        assign files = files | append: ', quick-add.js'
      endif
  
      if block.settings.quick_add == 'bulk'
        assign files = files | append: ', quick-add-bulk.js, quantity-popover.js, price-per-item.js, quick-order-list.js'
      endif
  
      assign files = files | split: ', '
      render 'theme-loader', files: files
    -%}
{%- endif -%}

{% schema %}
    {
        "name": "Product grid",
        "tag": null,
        "blocks": [{ "type": "card-product-flex" }],
        "settings": [
            {
                "type": "paragraph",
                "content": "t:sections.flexible-content.blocks.product_card.info"
            },
            {
                "type": "collection",
                "id": "collection",
                "label": "t:sections.featured-collection.settings.collection.label"
            },
            {
                "type": "range",
                "id": "products_to_show",
                "min": 2,
                "max": 25,
                "step": 1,
                "default": 4,
                "label": "t:sections.featured-collection.settings.products_to_show.label"
            },
            {
                "type": "range",
                "id": "columns_desktop",
                "min": 1,
                "max": 5,
                "step": 1,
                "default": 4,
                "label": "t:sections.featured-collection.settings.columns_desktop.label"
            },
            {
                "type": "select",
                "id": "quick_add",
                "default": "none",
                "label": "t:sections.main-collection-product-grid.settings.quick_add.label",
                "info": "t:sections.main-collection-product-grid.settings.quick_add.info",
                "options": [
                    {
                        "value": "none",
                        "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_1"
                    },
                    {
                        "value": "standard",
                        "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_2"
                    },
                    {
                        "value": "bulk",
                        "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_3"
                    }
                ]
            }
            
        ],
        "presets": [
            {
                "name": "Product grid",
                "blocks": [
                    {
                        "id": "product-slide-item",
                        "type": "card-product-flex",
                        "static": true,
                        "settings": {
                            "product": "{{ closest.product }}"
                        },
                        "blocks": [
                            {
                                "type": "card-product-media-flex",
                                "settings": {
                                    "product": "{{ closest.product }}",
                                    "image_ratio": "adapt",
                                    "show_secondary_image": true,
                                    "enable_quick_add": true
                                }
                            },
                            {
                                "type": "spacer",
                                "settings": {
                                    "spacer_height": 6
                                }
                            },
                            {
                                "type": "card-product-vendor-flex",
                                "settings": {
                                    "product": "{{ closest.product }}"
                                }
                            },
                            {
                                "type": "card-product-title-flex",
                                "settings": {
                                    "product": "{{ closest.product }}"
                                }
                            },
                            {
                                "type": "card-product-price-flex",
                                "settings": {
                                    "product": "{{ closest.product }}"
                                }
                            },
                            {
                                "type": "card-product-variant-flex",
                                "settings": {
                                    "product": "{{ closest.product }}"
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    }
{% endschema %}
