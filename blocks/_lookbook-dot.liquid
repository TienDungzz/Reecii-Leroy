{% liquid
  assign block_stts = block.settings
  assign dot_inner_color = block_stts.dot_inner_color
  assign dot_outer_color = block_stts.dot_outer_color
  assign dot_size_desktop = block_stts.dot_size_desktop | append: 'px'
  assign dot_size_mobile = block_stts.dot_size_mobile | append: 'px'
  assign dot_position_top = block_stts.dot_position_top | append: '%'
  assign dot_position_left = block_stts.dot_position_left | append: '%'

  assign card_product = block_stts.product
  assign card_product_option = block_stts.card_product_option
  assign show_product_image = block_stts.show_product_image
  assign show_product_title = block_stts.show_product_title
  assign show_product_price = block_stts.show_product_price
  assign show_product_variant = block_stts.show_product_variant
  assign show_product_button = block_stts.show_product_button
%}

<lookbook-dot class="lookbook-dot" style="--dot-inner-color: {{ dot_inner_color }}; --dot-outer-color: {{ dot_outer_color }}; --dot-size-desktop: {{ dot_size_desktop }}; --dot-size-mobile: {{ dot_size_mobile }}; --dot-position-top: {{ dot_position_top }}; --dot-position-left: {{ dot_position_left }};">
  <div class="lookbook-dot__icon" data-product-lookbook>
  </div>
  <div class="lookbook-dot__content">
    {% render 'card-lookbook', card_product: card_product, show_product_image: show_product_image, show_product_title: show_product_title, show_product_price: show_product_price, show_product_variant: show_product_variant, show_product_button: show_product_button, option: card_product_option %}
    </div>
</lookbook-dot>

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const lookbookDots = document.querySelectorAll('lookbook-dot');

    lookbookDots.forEach(dot => {

      dot.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const content = this.querySelector('.lookbook-dot__content');

        if (content) {
          if (window.innerWidth > 1024) {
            content.classList.toggle('is-open');
          } else {
            // open popup
            content.closest('.lookbook-item').querySelector('.lookBook__btnShowProducts .show_products').click();

            // scroll to product the same as index of dot
            const index = Array.from(lookbookDots).indexOf(this);
            const swiperEl = document.querySelector('.lookbook-popup .swiper');

            if (swiperEl) {
              swiperEl.swiper.slideTo(index, 600); 
            }
          }
        }
      });
    });

    // remove when click outside
    document.addEventListener('click', function(e) {
      if (! e.target.closest('lookbook-dot')) {
        lookbookDots.forEach(dot => {
          const content = dot.querySelector('.lookbook-dot__content');
          if (content) {
            content.classList.remove('is-open');
          }
        });
      }
    });
  });
{% endjavascript %}

{% schema %}
  {
    "name": "Lookbook dot",
    "settings": [
      {
        "type": "header",
        "content": "Dot"
      },
      {
        "type": "color",
        "id": "dot_inner_color",
        "label": "Dot inner color",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "dot_outer_color",
        "label": "Dot outer color",
        "default": "#2d2d2d"
      },
      {
        "type": "range",
        "id": "dot_size_desktop",
        "label": "Dot size desktop",
        "default": 12,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_size_mobile",
        "label": "Dot size mobile",
        "default": 8,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_top",
        "label": "Dot position top",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_left",
        "label": "Dot position left",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "header",
        "content": "Product"
      },
      {
        "type": "product",
        "id": "product",
        "label": "t:sections.collage.blocks.product.settings.product.label"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "info": "t:sections.all.colors.has_cards_info",
        "default": "scheme-1"
      },
      {
        "type": "select",
        "id": "card_product_option",
        "label": "Card product option",
        "options": [
          { "value": "vertical", "label": "Vertical" },
          { "value": "horizontal", "label": "Horizontal" }
        ],
        "default": "horizontal"
      },
      {
        "type": "checkbox",
        "id": "show_product_image",
        "label": "Show product image",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_title",
        "label": "Show product title",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_price",
        "label": "Show product price",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_variant",
        "label": "Show product variant",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_button",
        "label": "Show product button",
        "default": false
      }
    ],
    "presets": [
      {
        "name": "Lookbook dot"
      }
    ]
  }
{% endschema %}