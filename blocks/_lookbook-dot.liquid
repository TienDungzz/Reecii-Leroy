{% liquid
  assign block_stts = block.settings
  assign dot_inner_color = block_stts.dot_inner_color
  assign dot_outer_color = block_stts.dot_outer_color
  assign dot_size_desktop = block_stts.dot_size_desktop | append: 'px'
  assign dot_size_mobile = block_stts.dot_size_mobile | append: 'px'
  assign dot_position_top = block_stts.dot_position_top | append: '%'
  assign dot_position_left = block_stts.dot_position_left | append: '%'

  assign card_product = block_stts.product
  assign card_product_option = block_stts.card_product_option
  assign show_product_image = block_stts.show_product_image
  assign show_product_title = block_stts.show_product_title
  assign show_product_price = block_stts.show_product_price
  assign show_product_variant = block_stts.show_product_variant
  assign show_product_button = block_stts.show_product_button
%}

<lookbook-dot class="lookbook-dot" style="--dot-inner-color: {{ dot_inner_color }}; --dot-outer-color: {{ dot_outer_color }}; --dot-size-desktop: {{ dot_size_desktop }}; --dot-size-mobile: {{ dot_size_mobile }}; --dot-position-top: {{ dot_position_top }}; --dot-position-left: {{ dot_position_left }};" {{ block.shopify_attributes }}>
  <div class="lookbook-dot__icon" data-product-lookbook>
    <span class="svg-wrapper icon-plus-wrapper">
      {{- 'icon-plus.svg' | inline_asset_content -}}
    </span>
  </div>
  <div class="lookbook-dot__content">
    {% render 'card-lookbook', card_product: card_product, show_product_image: show_product_image, show_product_title: show_product_title, show_product_price: show_product_price, show_product_variant: show_product_variant, show_product_button: show_product_button, option: card_product_option %}
    </div>
</lookbook-dot>

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const lookbookDots = document.querySelectorAll('lookbook-dot');

    lookbookDots.forEach(dot => {

      dot.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const content = this.querySelector('.lookbook-dot__content');

        if (content) {
          if (window.innerWidth > 1024) {
            // Remove active class from all dots
            lookbookDots.forEach(d => d.classList.remove('is-active'));
            
            // Toggle content visibility
            const isOpen = content.classList.toggle('is-open');
            
            // Add active class if content is open
            if (isOpen) {
              this.classList.add('is-active');
            }
          } else {
            // Remove active class from all dots
            lookbookDots.forEach(d => d.classList.remove('is-active'));
            
            // Add active class to current dot
            this.classList.add('is-active');
            
            // open popup
            content.closest('.lookbook-item').querySelector('.lookBook__btnShowProducts .show_products')?.click();

            // scroll to product the same as index of dot
            const index = Array.from(lookbookDots).indexOf(this);
            const swiperEl = document.querySelector('.lookbook-popup .swiper');

            if (swiperEl) {
              swiperEl.swiper.slideTo(index, 600); 
            }
          }
        }
      });
    });

    // remove when click outside
    document.addEventListener('click', function(e) {
      if (! e.target.closest('lookbook-dot')) {
        lookbookDots.forEach(dot => {
          const content = dot.querySelector('.lookbook-dot__content');
          if (content) {
            content.classList.remove('is-open');
          }
          dot.classList.remove('is-active');
        });
      }
    });
  });
{% endjavascript %}

{% schema %}
  {
    "name": "Lookbook dot",
    "tag": null,
    "settings": [
      {
        "type": "header",
        "content": "Dot"
      },
      {
        "type": "color",
        "id": "dot_inner_color",
        "label": "t:settings.inner_color",
        "alpha": true,
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "dot_outer_color",
        "label": "t:settings.outer_color",
        "alpha": true,
        "default": "#2d2d2d"
      },
      {
        "type": "range",
        "id": "dot_size_desktop",
        "label": "t:settings.desktop_size",  
        "default": 12,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_size_mobile",
        "label": "t:settings.mobile_size",
        "default": 8,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_top",
        "label": "t:settings.position_top",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_left",
        "label": "t:settings.position_left",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "header",
        "content": "Product"
      },
      {
        "type": "product",
        "id": "product",
        "label": "t:sections.collage.blocks.product.settings.product.label"
      },
      {
        "type": "select",
        "id": "card_product_option",
        "label": "t:settings.card_product_option",
        "options": [
          { 
            "value": "vertical",
            "label": "t:options.vertical"
          },
          { 
            "value": "horizontal",
            "label": "t:options.horizontal" 
          }
        ],
        "default": "horizontal"
      },
      {
        "type": "checkbox",
        "id": "show_product_image",
        "label": "t:settings.show_product_image",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_title",
        "label": "t:settings.show_product_title",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_price",
        "label": "t:settings.show_product_price",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_variant",
        "label": "t:settings.show_product_variant",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_button",
        "label": "t:settings.show_product_button",
        "default": false
      },
      {
        "type": "select",
        "id": "quick_add",
        "default": "none",
        "label": "t:sections.main-collection-product-grid.settings.quick_add.label",
        "info": "t:sections.main-collection-product-grid.settings.quick_add.info",
        "options": [
          {
            "value": "none",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_1"
          },
          {
            "value": "standard",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_2"
          },
          {
            "value": "bulk",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_3"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Lookbook dot"
      }
    ]
  }
{% endschema %}