{% liquid
  assign block_stts = block.settings
  assign dot_inner_color = block_stts.dot_inner_color
  assign dot_outer_color = block_stts.dot_outer_color
  assign dot_size_desktop = block_stts.dot_size_desktop | append: 'px'
  assign dot_size_mobile = block_stts.dot_size_mobile | append: 'px'
  assign dot_position_top = block_stts.dot_position_top | append: '%'
  assign dot_position_left = block_stts.dot_position_left | append: '%'

  assign card_product = block_stts.product
  assign show_product_image = block_stts.show_product_image
  assign show_product_title = block_stts.show_product_title
  assign show_product_price = block_stts.show_product_price
  assign show_product_variant = block_stts.show_product_variant
  assign show_product_button = block_stts.show_product_button
%}

<lookbook-dot class="lookbook-dot" style="--dot-inner-color: {{ dot_inner_color }}; --dot-outer-color: {{ dot_outer_color }}; --dot-size-desktop: {{ dot_size_desktop }}; --dot-size-mobile: {{ dot_size_mobile }}; --dot-position-top: {{ dot_position_top }}; --dot-position-left: {{ dot_position_left }};">
  <div class="lookbook-dot__icon" data-product-lookbook></div>
  <div class="lookbook-dot__content">
    {% render 'card-lookbook', card_product: card_product, show_product_image: show_product_image, show_product_title: show_product_title, show_product_price: show_product_price, show_product_variant: show_product_variant, show_product_button: show_product_button, option: 'vertical' %}
    </div>
</lookbook-dot>

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const lookbookDots = document.querySelectorAll('lookbook-dot');

    lookbookDots.forEach(dot => {

      dot.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const content = this.querySelector('.lookbook-dot__content');

        if (content) {
          content.classList.toggle('is-open');
        }
      });
    });

    // remove when click outside
    document.addEventListener('click', function(e) {
      if (! e.target.closest('lookbook-dot')) {
        lookbookDots.forEach(dot => {
          const content = dot.querySelector('.lookbook-dot__content');
          if (content) {
            content.classList.remove('is-open');
          }
        });
      }
    });
  });
{% endjavascript %}

{% stylesheet %}
  .lookbook-dot {
    position: absolute;
    display: flex;
    align-items: center;
    z-index: 5;
    pointer-events: auto;
    left: var(--dot-position-left);
    top: var(--dot-position-top);
    cursor: pointer;
  }
  .lookbook-dot__icon {
    position: relative;
    width: var(--dot-size-desktop);
    height: var(--dot-size-desktop);
    background-color: var(--dot-inner-color);
    color: var(--dot-inner-color);
    border-radius: 50%;
  }

  .lookbook-dot__icon::before {
    content: "";
    position: absolute;
    top: -7px;
    left: -7px;
    width: 26px;
    height: 26px;
    z-index: -1;
    border-radius: 50%;
    opacity: .5;
    background-color: var(--dot-outer-color);
  }

  .lookbook-dot__icon::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    border-radius: 50%;
    opacity: .3;
    background-color: var(--dot-outer-color);
    animation: dot-zoom-animation 1.8s ease-in-out infinite
  }

  @keyframes dot-zoom-animation {
    0% {
      transform: scale3d(2, 2, 1);
    }
    50% {
      transform: scale3d(3, 3, 1);
    }
    100% {
      transform: scale3d(2, 2, 1);
    }
  }
{% endstylesheet %}

{% schema %}
  {
    "name": "Lookbook dot",
    "settings": [
      {
        "type": "header",
        "content": "Dot"
      },
      {
        "type": "color",
        "id": "dot_inner_color",
        "label": "Dot inner color",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "dot_outer_color",
        "label": "Dot outer color",
        "default": "#2d2d2d"
      },
      {
        "type": "range",
        "id": "dot_size_desktop",
        "label": "Dot size desktop",
        "default": 12,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_size_mobile",
        "label": "Dot size mobile",
        "default": 8,
        "min": 1,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_top",
        "label": "Dot position top",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "range",
        "id": "dot_position_left",
        "label": "Dot position left",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1
      },
      {
        "type": "header",
        "content": "Product"
      },
      {
        "type": "product",
        "id": "product",
        "label": "t:sections.collage.blocks.product.settings.product.label"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "info": "t:sections.all.colors.has_cards_info",
        "default": "scheme-1"
      },
      {
        "type": "checkbox",
        "id": "show_product_image",
        "label": "Show product image",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_title",
        "label": "Show product title",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_price",
        "label": "Show product price",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_variant",
        "label": "Show product variant",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_product_button",
        "label": "Show product button",
        "default": false
      }
    ],
    "presets": [
      {
        "name": "Lookbook dot"
      }
    ]
  }
{% endschema %}