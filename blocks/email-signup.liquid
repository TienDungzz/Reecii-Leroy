<div class="footer-block__newsletter">
  {%- form 'customer', id: 'ContactFooter', class: 'footer__newsletter newsletter-form' -%}
    <input type="hidden" name="contact[tags]" value="newsletter">
    <div class="newsletter-form__field-wrapper dis-flex {% if block.settings.full_width %} newsletter-form__field-wrapper--full {% endif %}">
      <div
        class="field field--style-{{ block.settings.field_style }}"
        style="--gap-a: {{ block.settings.form_gap }}px;"
      >
        <input
          id="NewsletterForm--{{ block.id }}"
          type="email"
          name="contact[email]"
          class="field__input"
          value="{{ form.email }}"
          aria-required="true"
          autocorrect="off"
          autocapitalize="off"
          autocomplete="email"
          {% if form.errors %}
            autofocus
            aria-invalid="true"
            aria-describedby="ContactFooter-error"
          {% elsif form.posted_successfully? %}
            aria-describedby="ContactFooter-success"
          {% endif %}
          placeholder="{{ 'newsletter.label' | t }}"
          required
        >
        <label class="field__label" for="NewsletterForm--{{ block.id }}">
          {{ 'newsletter.label' | t }}
        </label>
        <button
          type="submit"
          class="newsletter-form__button field__button button"
          name="commit"
          id="Subscribe"
          aria-label="{{ 'newsletter.button_label' | t }}"
        >
          <span class="svg-wrapper">
            {{- 'icon-arrow.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>
      {%- if form.errors -%}
        <small class="newsletter-form__message form__message" id="ContactFooter-error">
          <span class="svg-wrapper">
            {{- 'icon-error.svg' | inline_asset_content -}}
          </span>
          {{- form.errors.translated_fields.email | capitalize }}
          {{ form.errors.messages.email -}}
        </small>
      {%- endif -%}
    </div>

    {%- if block.settings.agree_condition -%}
      <div class="newsletter-form__checkbox">
        <input
          type="checkbox"
          id="agree_condition"
          name="agree_condition"
          class="checkbox__input"
          required
        >
        <label for="agree_condition" class="checkbox__label">
          {{ block.settings.content }}
        </label>
      </div>
    {%- endif -%}

    {%- if form.posted_successfully? -%}
      <h3
        class="newsletter-form__message newsletter-form__message--success form__message"
        id="ContactFooter-success"
        tabindex="-1"
        autofocus
      >
        <span class="svg-wrapper">
          {{- 'icon-success.svg' | inline_asset_content -}}
        </span>
        {{- 'newsletter.success' | t }}
      </h3>
    {%- endif -%}
  {%- endform -%}
</div>

<script>
  const form = document.getElementById('ContactFooter');
  const checkbox = document.getElementById('agree_condition');
  const submitButton = form.querySelector("button[type='submit']");

  if (!checkbox) return;

  submitButton.disabled = true;

  checkbox.addEventListener('change', function () {
    submitButton.disabled = !checkbox.checked;
  });

  form.addEventListener('submit', function (e) {
    if (!checkbox.checked) {
      e.preventDefault();
      alert('Please agree to the terms and conditions before submitting.');
    }
  });
</script>

{% schema %}
{
  "name": "Email signup",
  "blocks": [],
  "settings": [
    {
      "type": "header",
      "content": "t:sections.newsletter.settings.submit_form.label"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "t:sections.newsletter.settings.submit_form.full_width.label",
      "info": "t:sections.newsletter.settings.submit_form.full_width.info",
      "default": false
    },
    {
      "type": "select",
      "id": "field_style",
      "label": "t:sections.newsletter.settings.submit_form.field_style.label",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "t:sections.newsletter.settings.submit_form.field_style.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.newsletter.settings.submit_form.field_style.options__2.label"
        },
        {
          "value": "3",
          "label": "t:sections.newsletter.settings.submit_form.field_style.options__3.label"
        }
      ]
    },
    {
      "type": "range",
      "id": "form_gap",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 5,
      "label": "t:sections.newsletter.settings.submit_form.form_gap.label",
      "info": "t:sections.newsletter.settings.submit_form.form_gap.info"
    },
    {
      "type": "header",
      "content": "t:sections.newsletter.settings.agree_condition.label"
    },
    {
      "type": "header",
      "content": "t:sections.newsletter.settings.agree_condition.label"
    },
    {
      "type": "checkbox",
      "id": "agree_condition",
      "label": "t:sections.newsletter.settings.agree_condition.label",
      "info": "t:sections.newsletter.settings.agree_condition.info"
    },
    {
      "type": "inline_richtext",
      "id": "content",
      "label": "t:sections.newsletter.settings.agree_condition.content",
      "default": "I agree with the terms and conditions"
    }
  ],
  "presets": [
    {
      "name": "Email signup"
    }
  ]
}
{% endschema %}
