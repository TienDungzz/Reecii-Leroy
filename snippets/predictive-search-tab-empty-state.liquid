
{% comment %}
  Predictive search tab layout using tabs-component.
  - Each tab: Products, Collections, Pages, Articles (if available)
  - Use tabs-component for tab switching
  - Render results in each tab
{% endcomment %}

{%- assign tabs = '' -%}
{%- assign tab_labels = '' -%}

{%- if settings.quick_collections != blank -%}
  {%- assign title = 'content.products' | t -%}
  {%- assign tabs = tabs | append: 'products,' -%}
  {%- assign tab_labels = tab_labels | append: title | append: ',' -%}
{%- endif -%}
{%- if settings.quick_links != blank -%}
  {%- assign title = 'content.search_results_quick_links' | t -%}
  {%- assign tabs = tabs | append: 'collections,' -%}
  {%- assign tab_labels = tab_labels | append: title | append: ',' -%}
{%- endif -%}

{%- assign tabs = tabs | split: ',' -%}
{%- assign tab_labels = tab_labels | split: ',' -%}

{%- if tab_labels.size > 0 -%}
  <tabs-component class="predictive-search-tabs block">
    <div class="tabs-product-header flex overflow-x-a mb-4">
      {%- capture labels -%}
        {%- for label in tab_labels -%}
          {{ label }}
          {%- unless forloop.last -%}
            ,
          {%- endunless -%}
        {%- endfor -%}
      {%- endcapture -%}

      {%- render 'tab-header-item',
        id: 'predictive-search-tabs',
        labels: labels,
        class: 'predictive-search-tab__trigger',
        style: ''
      -%}
    </div>
    <div class="tabs-product-grid tabs-component-content">
      {%- for tab in tabs -%}
        <div
          class="predictive-search-tab__panel tabs-component-content{% if forloop.first %} --active{% endif %}"
          data-tabs-panel
          data-tab-index="{{ forloop.index0 }}"
          {% unless forloop.first %}
            hidden
          {% endunless %}
          id="tabs-predictive-search-tabs-{{ forloop.index }}"
        >
          {%- case tab -%}
            {%- when 'products' -%}
              {% assign products = settings.quick_collections.products %}
              {% assign products_test_id = 'products-list-results' %}
              {% assign title = 'content.products' | t %}
              {% if products.size > 0 %}
                {% render 'predictive-search-products-list',
                  products_test_id: products_test_id,
                  title: title,
                  products: products,
                  limit: 9
                %}
              {% else %}
                <div class="predictive-search-results__no-results">
                  <p>{{ 'content.no_products_found' | t }}</p>
                </div>
              {% endif %}
            {%- when 'collections' -%}
              {% assign collections = settings.quick_links.links %}
              {% if collections.size > 0 %}
                <ul class="predictive-search__results-list list-unstyled">
                  {%- for collection in collections -%}
                    <li class="predictive-search__list-item">
                      <a href="{{ collection.url }}" class="predictive-search__item link link--text link--hover-underline">
                        <div class="predictive-search__item-content">
                          <p class="predictive-search__item-heading">{{ collection.title | escape }}</p>
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              {% else %}
                <div class="predictive-search-results__no-results">
                  <p>{{ 'content.no_links_found' | t }}</p>
                </div>
              {% endif %}
          {%- endcase -%}
        </div>
      {%- endfor -%}
    </div>
  </tabs-component>
{%- else -%}
  <div class="predictive-search-results__no-results">
    <p>{{ 'content.no_results_found' | t }}</p>
  </div>
{%- endif -%}

{%- stylesheet -%}
  .predictive-search-tabs .tabs-product-header {
    gap: var(--gap-2xl);
    margin-bottom: 1rem;
  }

  .predictive-search-tab__trigger {
    background: none;
    border: none;
    padding: 0.8rem 0;
    position: relative;
    &:before ,
    &:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 0.1rem;
      background-color: rgba(var(--color-border-rgb) / var(--opacity-20));
      transition: background-color var(--animation-speed-slow) var(--animation-easing), transform var(--animation-speed-slow) var(--animation-easing);
      transform-origin: right;
    }

    &:after {
      transform: scaleX(0);
      background-color: rgba(var(--color-border-rgb) / var(--opacity-100));
    }
  }

  .predictive-search-tab__trigger.--active:after{
    transform: scaleX(1);
    transform-origin: left;
  }

  .predictive-search-tab__panel {
    display: none;
    padding-top: 1rem;

    &.--active {
      display: block;
    }
  }
{%- endstylesheet -%}