{%- liquid
  assign menu_tab = blocks | where: 'type', 'menu_tab'
-%}

{%- if menu_tab.size > 0 -%}
  <div
    class="header-multi-site{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
  >
    <div
      class="flex overflow-x-a disable-srollbar"
      data-menu-tab
    >
      {%- for block in blocks -%}
        {% liquid
          assign bl_stts = block.settings

          assign text_color = bl_stts.text_color.rgb
          assign text_bg = bl_stts.text_bg
          assign text_color_active = bl_stts.text_color_active.rgb
          assign text_bg_active = bl_stts.text_bg_active.rgb

          assign text_style = '--color: ' | append: text_color | append: ';' | append: '--background-color: ' | append: text_bg | append: ';' | append: '--color-active: ' | append: text_color_active | append: ';' | append: '--background-color-active: ' | append: text_bg_active | append: ';'

          assign logo_width = '16'
          assign logo_width_mobile = '16'
          assign logo_height = logo_width | divided_by: bl_stts.logo.aspect_ratio | ceil
          assign logo_height_mobile = logo_width_mobile | divided_by: bl_stts.logo.aspect_ratio | ceil

          assign logo_style = '--header-logo-image-width: ' | append: 'auto;' | append: '--header-logo-image-width-mobile: ' | append: 'auto; --header-logo-image-height: ' | append: logo_height | append: 'px; --header-logo-image-height-mobile: ' | append: logo_height_mobile | append: 'px;'
        %}
        {%- case block.type -%}
          {%- when '@app' -%}
            {% render block %}
          {%- when 'menu_tab' -%}
            <div
              class="
                shrink-0
                {{ bl_stts | class_list }}
                {% if bl_stts.divider %} divider--right{% endif %}
              "
              style="{{ text_style }}"
            >
              {%- liquid
                assign page_handle = page.handle
                assign multi_site_handle = block.settings.link.handle
                assign multi_site_url = block.settings.link.url
                assign class = 'link link--multi-site'

                if forloop.first
                  assign class = class | append: ' link--multi-site--active'
                endif

                if multi_site_url != blank
                  assign url = multi_site_url
                else
                  assign url = routes.root_url
                endif
              -%}
              <a
                {% if url == blank %}
                  role="link" aria-disabled="true"
                {% else %}
                  href="{{ url }}"
                {% endif %}
                class="{{ class }}"
                data-handle-page="{{ multi_site_handle }}"
              >
                {%- if bl_stts.logo != blank -%}
                  {%- liquid
                    assign logo_alt = settings.logo.alt | default: shop.name | escape
                    assign image = bl_stts.logo
                  -%}
                  {% capture widths %}{{ section.settings.logo_width }}, {{ section.settings.logo_width | times: 1.5 | round }}, {{ section.settings.logo_width | times: 2 }}{% endcapture %}
                  {{
                    image
                    | image_url: width: 600
                    | image_tag:
                      image: settings.logo,
                      class: 'header__heading-logo motion-reduce',
                      widths: widths,
                      height: logo_height,
                      width: section.settings.logo_width,
                      text_fallback: text_fallback,
                      alt: logo_alt,
                      sizes: sizes,
                      style: logo_style,
                      fetch_priority: 'high'
                  }}
                {%- elsif bl_stts.logo_text != blank -%}
                  {{ bl_stts.logo_text }}
                {%- else -%}
                  {{ shop.name }}
                {%- endif -%}
              </a>
              {%- if multi_site_handle != blank -%}
                {%- assign menu = linklists[multi_site_handle].links -%}
                {% render 'header-menu-multi-site', blocks: blocks, menu: menu %}
              {%- endif -%}
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>

  <script type="text/javascript">
    window.page_active = '{{ page_handle }}';
  </script>
{%- endif -%}

{%- stylesheet -%}
  .header .link.link--multi-site {
    position: relative;
    color: rgb(var(--color));
    background-color: var(--background-color);
    padding: var(--padding-lg) var(--padding-xl);
    transition: color var(--animation-speed) var(--animation-timing-hover),
      background-color var(--animation-speed) var(--animation-timing-hover);
    display: block;
    height: 100%;
    &.link--multi-site--active {
      color: rgba(var(--color-active) / var(--opacity-100));
      background-color: rgba(var(--background-color-active) / var(--opacity-100));
    }

    svg {
      height: var(--size-16);
      width: auto;
      fill: currentColor;
    }

    &:hover {
      color: rgba(var(--color-active) / var(--opacity-80));
      background-color: rgba(var(--background-color-active) / var(--opacity-80));
    }
  }

  .header-multi-site .divider--right .link--multi-site:not(.link--multi-site--active)::before {
    content: '';
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: var(--size-1);
    height: var(--size-30);
    background-color: rgba(var(--color) / var(--opacity-30));
  }
{%- endstylesheet -%}
