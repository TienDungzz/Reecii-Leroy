{% comment %}
  Renders a set of links for paginated results. Must be used within paginate tags.

  Usage:
  {% paginate results by 2 %}
    {% render 'pagination', paginate: paginate, anchor: '#yourID' %}
  {% endpaginate %}

  Accepts:
  - paginate: {Object}
  - anchor: {String} (optional) This can be added so that on page reload it takes you to wherever you've placed your anchor tag.
  {% endcomment %}

  {% liquid
    assign pagination_type = section.settings.pagination_type
  %}

  {% capture list_class %}
    pagination__list list-unstyled flex flex-wrap justify-center
  {% endcapture %}

  {% capture item_class %}
    pagination__item inline-flex items-center justify-center relative w-full p-0 decoration-none color-foreground
  {% endcapture %}

  {%- if paginate.parts.size > 0 -%}
    <div class="pagination-wrapper">
      <nav
        class="pagination{% if pagination_type == 'infinite' %} hidden{% endif %}"
        role="navigation"
        aria-label="{{ 'general.pagination.label' | t }}"
      >
        <ul class="{{ list_class }}" role="list">
          {%- if paginate.previous -%}
            <li>
              <a
                href="{{ paginate.previous.url }}{{ anchor }}"
                class="{{ item_class }} pagination__item--next pagination__item-arrow link motion-reduce"
                aria-label="{{ 'general.pagination.previous' | t }}"
              >
                <span class="visually-hidden">{{ 'general.pagination.button_previous' | t }}</span>
                <span class="svg-wrapper">
                  {{- 'icon-arrow.svg' | inline_asset_content -}}
                </span>
              </a>
            </li>
          {%- endif -%}

          {%- for part in paginate.parts -%}
            <li>
              {%- if part.is_link -%}
                <a
                  href="{{ part.url }}{{ anchor }}"
                  class="{{ item_class }} link"
                  aria-label="{{ 'general.pagination.page' | t: number: part.title }}"
                >
                  {{- part.title -}}
                </a>
              {%- else -%}
                {%- if part.title == paginate.current_page -%}
                  <a
                    role="link"
                    aria-disabled="true"
                    class="{{ item_class }} pagination__item--current light"
                    aria-current="page"
                    aria-label="{{ 'general.pagination.page' | t: number: part.title }}"
                  >
                    {{- part.title -}}
                  </a>
                {%- else -%}
                  <span class="pagination__item">{{ part.title }}</span>
                {%- endif -%}
              {%- endif -%}
            </li>
          {%- endfor -%}

          {%- if paginate.next -%}
            <li>
              <a
                href="{{ paginate.next.url }}{{ anchor }}"
                class="{{ item_class }} pagination__item--prev pagination__item-arrow link motion-reduce"
                aria-label="{{ 'general.pagination.next' | t }}"
              >
                <span class="visually-hidden">{{ 'general.pagination.button_next' | t }}</span>
                <span class="svg-wrapper">
                  {{- 'icon-arrow.svg' | inline_asset_content -}}
                </span>
              </a>
            </li>
          {%- endif -%}
        </ul>
      </nav>

      {% if section.settings.pagination_type == 'infinite' %}
        <!-- Infinite Scrolling Button -->
        <infinite-scrolling class="infinite-scrolling-wrapper block center">
          <div class="pagination-page-item pagination-page-total flex-center flex-wrap gap-2xs">
            <span>{{ 'sections.collection_template.start_count' | t }}</span>
            <span data-total-start>{{ paginate.current_offset | plus: 1 }}</span>
            <span>-</span>
            {%- if paginate.next -%}
              <span data-total-end>{{ paginate.current_offset | plus: paginate.page_size }}</span>
            {%- else -%}
              <span data-total-end>{{ paginate.items }}</span>
            {%- endif -%}
            <span>{{ 'sections.collection_template.end_count' | t: count: paginate.items }}</span>
            {%- if paginate.next -%}
              {% liquid
                assign pg_current = paginate.current_offset | plus: paginate.page_size
                assign pg_total = paginate.items
                assign total_progress = pg_current | times: 100 | divided_by: pg_total | append: '%'
              %}
            {%- else -%}
              {%- assign total_progress = '100%' -%}
            {%- endif -%}
            <div class="progress-wrapper flex-center w-full">
              <div class="pagination-total-progress w-full overflow-hidden">
                <span style="width: {{ total_progress }}" class="pagination-total-item h-full block"></span>
              </div>
            </div>
          </div>

          <button
            type="button"
            class="button button--primary infinite-scrolling-btn"
            data-infinite-scrolling
            aria-label="{{ 'sections.collection_template.show_more' | t }}"
          >
            <span class="text">
              {%- if paginate.next -%}
                {{ 'sections.collection_template.show_more' | t }}
              {%- else -%}
                {{ 'sections.collection_template.no_more' | t }}
              {%- endif -%}
            </span>
            {% render 'loading-spinner' %}
          </button>
        </infinite-scrolling>
      {%- endif -%}
    </div>
  {%- endif -%}

  {% stylesheet %}
    .pagination__list > li {
      min-width: 4rem;
    }
    .pagination__list > li:not(:last-child) {
      margin-right: 1.6rem;
    }
    .pagination__item {
      height: 4rem;
      background-color: rgba(var(--color-foreground-rgb) / 0.05);
      border-radius: var(--style-border-radius-buttons-secondary);
      font-size: var(--body-s-font-size);
      box-shadow: rgba(var(--color-foreground-rgb) / 0) 0rem 0rem 0rem 0rem;
      transition: background-color var(--animation-speed) var(--ease-out-smooth),
        box-shadow var(--animation-speed) var(--ease-out-smooth);
      padding: 0 1.4rem;
    }
    .pagination__item {
      display: inline-flex;
      border: var(--style-border-width) solid transparent;
    }
    .pagination__item--current {
      border-color: rgba(var(--color-foreground-rgb) / 0.05);
    }
    .pagination__item--current,
    a.pagination__item:hover {
      background: transparent;
    }
    a.pagination__item:hover {
      box-shadow: rgba(var(--color-foreground-rgb) / 0.25) 0 4px 4px 0;
    }
    .pagination__item--next,
    .pagination__item--prev {
      transition: transform var(--animation-speed) var(--ease-out-smooth);

      &:hover {
        border-color: rgba(var(--color-foreground-rgb) / 1);
      }
    }
    .pagination__list > li:has(.pagination__item--next) {
      margin-right: 2rem;
    }
    .pagination__list > li:has(.pagination__item--prev) {
      margin-left: 0.4rem;
    }
    .pagination__item--next .icon {
      margin-left: -0.2rem;
      transform: rotate(180deg);
    }
    .pagination__item--next:hover .icon {
      transform: rotate(180deg) scale(1.07);
    }
    .pagination__item--prev .icon {
      margin-right: -0.2rem;
    }
    .pagination__item--prev:hover .icon {
      transform: scale(1.07);
    }

    /* Infinite Scrolling Styles */
    .infinite-scrolling-wrapper {
      margin-top: 2rem;
    }

    .infinite-scrolling-btn.loading {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;

      .text {
        opacity: 0;
      }
    }

    /* Hide pagination when infinite scrolling is active */
    .pagination-wrapper.infinite-scrolling-active .pagination {
      display: none;
    }

    .pagination-wrapper.infinite-scrolling-active .infinite-scrolling-wrapper {
      display: block;
    }

    /* Loading state for products */
    .product-grid.loading {
      opacity: 0.7;
      pointer-events: none;
    }

    /* Smooth transition for new products */
    .product-grid__item {
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Pagination Progress Styles */
    .pagination-page-item.pagination-page-total {
      margin: var(--margin-sm) 0;
      font-size: var(--body-s-font-size, 1.4rem);
      color: var(--color-foreground, #000);
    }

    .progress-wrapper {
      margin-top: 0.5rem;
    }

    .pagination-total-progress {
      height: 0.4rem;
      background-color: rgba(var(--color-foreground-rgb, 0, 0, 0) / 0.1);
      border-radius: var(--style-border-radius-xs);
      max-width: 16rem;
    }

    .pagination-total-item {
      background-color: var(--color-button, #000);
      border-radius: var(--style-border-radius-xs);
      transition: width 0.5s ease-in-out;
    }

    /* Animation for updating numbers */
    [data-total-start].updating,
    [data-total-end].updating {
      animation: numberUpdate 0.5s ease-in-out;
    }

    @keyframes numberUpdate {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
        color: var(--color-button, #000);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Responsive adjustments */
    @media (max-width: 749px) {
      .infinite-scrolling-btn {
        min-width: 16rem;
        padding: 1rem 2rem;
        font-size: 1.3rem;
      }

      .pagination-page-item.pagination-page-total {
        gap: 0.3rem;
        font-size: 1.3rem;
      }
    }
  {% endstylesheet %}
