{% comment %}
  Renders a mega_menu for the header.

  Usage:
  {% render 'header-menu' %}
{% endcomment %}

{%- liquid
  assign menu_tab = blocks | where: 'type', 'menu_tab'
  if menu_tab.size > 0
    assign has_menu_tab = true
  else
    assign has_menu_tab = false
  endif
-%}

{% comment %} <link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-mega-menu.css' | asset_url }}" media="print" onload="this.media='all'"> {% endcomment %}
{{ 'component-list-menu.css' | asset_url | stylesheet_tag: preload: true }}
{{ 'component-mega-menu.css' | asset_url | stylesheet_tag: preload: true }}
<noscript>
  {{ 'component-list-menu.css' | asset_url | stylesheet_tag: preload: true }}
  {{ 'component-mega-menu.css' | asset_url | stylesheet_tag: preload: true }}
</noscript>

<div
  class="header-block header-menu grid__item flex items-center justify-center"
  style="--gap-x: {{ section.settings.gap_x }}px;"
>
  {%- liquid
    assign vertical_menu_blocks = blocks | where: 'type', 'vertical_menu'

    for block in vertical_menu_blocks
      assign bl_stts = block.settings
      assign vertical_menu_style = bl_stts.vertical_menu_style
    endfor

    if vertical_menu_style == 'style_1'
      render 'header-menu-vertical', blocks: blocks, bl_stts: bl_stts
    endif

    assign keys = 'highlighted_item_,new_label_,sale_label_'
  -%}
  <div class="header__menu-wrapper" data-main-menu>
    <nav class="header__inline-menu">
      <ul class="list-menu list-menu-desktop list-menu--inline{% if has_menu_tab %} hidden{% endif %}" role="list">
        {%- for link in header_settings.menu.links -%}
          <li>
            {%- if link.links != blank -%}
              {% comment %}
                if check_mega_menu_1 and has_mega_menu_1
                  render 'header-mega-menu-1', link: link, forloopIndex: forloop.index, block: block, icon_type: icon_type, keys: keys, sec_settings: section.settings, class_item_hover_reveal: class_item_hover_reveal
                elsif check_mega_menu_2 and has_mega_menu_2
                  render 'header-mega-menu-2', link: link, forloopIndex: forloop.index, block: block, icon_type: icon_type, keys: keys, sec_settings: section.settings, class_item_hover_reveal: class_item_hover_reveal
                elsif check_mega_menu_3 and has_mega_menu_3
                  render 'header-mega-menu-3', link: link, forloopIndex: forloop.index, block: block, icon_type: icon_type, keys: keys, sec_settings: section.settings, class_item_hover_reveal: class_item_hover_reveal
                else
                  render 'header-dropdown-menu', link: link, forloopIndex: forloop.index, icon_type: icon_type, sec_settings: section.settings, class_item_hover_reveal: class_item_hover_reveal
                endif
              {% endcomment %}
              <details
                id="Details-HeaderMenu-{{ forloopIndex }}"
                class="details--dropdown mega-menu"
                is="dropdown-details"
                activate-event="hover"
                data-index="0"
              >
                <summary
                  id="HeaderMenu-{{ link.handle }}"
                  class="
                    details__summary
                    list-menu__item menu__link--level-1 header__menu-item list-menu__item link focus-inset link--hover-underline
                    {% render 'highlight-class', order: '1', keys: keys, compare: link.title, settings: sec_settings %}
                  "
                  {%- if link.links != blank -%}
                    aria-controls="submenu-{{ forloop.index }}"
                    aria-haspopup="true"
                    aria-expanded="false"
                  {%- endif -%}
                  style="{%  render 'highlight-style', order: '1', keys: keys, compare: link.title, settings: sec_settings %}"
                >
                  {% if is_vertical_menu %}
                    {% liquid
                      assign width = 20

                      assign ratio = 1

                      assign image_style = 'width: ' | append: width | append: 'px;' | append: ';' | append: '--media-adapt-ratio:' | append: ratio | append: ';'

                      assign image_sources = 'jpg,png,webp,avif' | split: ','
                      assign found_image = false
                    -%}

                    {% for ext in image_sources %}
                      {% assign ext = ext | strip %}
                      {% assign item_image = link.handle | downcase | replace: ' ', '-' | append: '.' | append: ext %}
                      {% if images[item_image] != blank and found_image == false %}
                        {% assign found_image = true %}
                        {% assign image = item_image | file_url %}
                        <span class="icon-image" style="{{ image_style }}">
                          <img
                            src="{{ image }}"
                            srcset="{{ image }} 450w, {{ image }} 900w"
                            width="450"
                            height="450"
                            sizes="{{ sizes }}"
                            loading="lazy"
                            alt="{{ shop.name | escape }}"
                          >
                        </span>
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                  <a
                    class="text{% if link.child_active %} header__active-menu-item{% endif %}"
                    {% if link.url != blank %}
                      href="{{ link.url }}"
                    {% else %}
                      role="link" aria-disabled="true"
                    {% endif %}
                  >
                    {{- link.title | escape -}}
                  </a>
                  {% if icon_type == 'caret' %}
                    <span class="svg-wrapper">
                      {{- 'icon-caret.svg' | inline_asset_content -}}
                    </span>
                  {% endif %}
                  {% render 'highlight-label-menu',
                    order: '1',
                    keys: keys,
                    compare: link.title,
                    settings: sec_settings
                  %}
                </summary>
                <div class="details__list mega-menu__content z-1 motion-reduce global-settings-popup color-{{ section.settings.color_scheme_top }}" tabindex="-1">
                  {%- render 'header-nav-mega',
                    blocks: blocks,
                    link: link,
                    forloopIndex: forloop.index,
                    block: block,
                    icon_type: icon_type,
                    keys: keys,
                    sec_settings: section.settings,
                    class_item_hover_reveal: class_item_hover_reveal
                  -%}
                </div>
              </details>
            {%- else -%}
              <a
                id="HeaderMenu-{{ link.handle }}"
                href="{{ link.url }}"
                class="header__menu-item list-menu__item link link--text focus-inset link--hover-underline"
                {% if link.current %}
                  aria-current="page"
                {% endif %}
              >
                <span
                  class="text{% if link.current %} header__active-menu-item{% endif %}"
                >
                  {{- link.title | escape -}}
                </span>
              </a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>
  </div>
</div>

{%- stylesheet -%}
{%- endstylesheet -%}
