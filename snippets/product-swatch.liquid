{%- liquid
    assign variant_selected = variant_selected | handleize
    assign variantCount = product.variants | size
    assign swatch_type = settings.swatch_type
    assign colorList = '|'
    assign color = ''
    assign count = 0
    if settings.enable_custom_position_swatch_layout_card_1
        assign number_limit = 5
    else
        assign number_limit = 4
    endif
-%}

{%- capture class_swatch -%}
    swatch cursor-pointer block max-w-full
{%- endcapture -%}

{%- capture class_tooltip -%}
    tooltip center absolute bottom-full left-50 z-1 whitespace-nowrap capitalize text-sm
{%- endcapture -%}

{%- if variantCount > 0 and product.variants.first.title != 'Default Title' -%}
    <div class="card__swatch relative z-2" id="product-swatch-{{ product.id }}">
        <color-swatch>
            <ul class="swatch-list list-unstyled flex flex-wrap items-center justify-{{ alignment | replace: 'left', 'start' | replace: 'right', 'end' }}" style="--gap: 0.6rem;">
                {%- for variant in product.variants -%}
                    {%- assign color = variant.options[index] -%}
                    {%- assign color_check = color | prepend: "|" | append: "|" -%}
                    {%- unless colorList contains color_check -%}
                        {%- liquid
                            assign text = color | handleize
                            assign enable_variant_image = false
                            case swatch_type
                            when 'variant_image'
                                assign background_image = variant.image.src | product_img_url: '40x'
                                if variant.image
                                    assign enable_variant_image = true
                                endif
                            when 'color'
                                assign background_image = color | handle | append: '.png' | file_url
                                assign enable_variant_image = true
                            when 'metaobjects'
                                assign metaobject_color = color.swatch.color
                                assign metaobject_image = color.swatch.image
                                assign has_metaobject = false
                                if metaobject_image != blank
                                    assign background_image = metaobject_image | product_img_url: '40x'
                                    assign enable_variant_image = true
                                    assign has_metaobject = true
                                elsif metaobject_color != blank
                                    assign background_color = metaobject_color
                                    assign enable_variant_image = true
                                    assign has_metaobject = true
                                    assign background_image = ''
                                elsif variant.image
                                    assign background_image = variant.image.src | product_img_url: '40x'
                                    assign enable_variant_image = true
                                else
                                    assign background_color = color | handle
                                    assign has_metaobject = true
                                    assign enable_variant_image = true
                                endif
                        endcase
                        -%}
                        {%- if count < number_limit -%}
                            <li class="swatch-item relative">
                                <div class="swatch-wrapper">
                                    <span
                                        {% if enable_variant_image %}
                                          class="{{ class_swatch }} color-swacth-color--{{ color | handle }}"
                                          style="{%- if swatch_type == 'color' -%}--swatch--background-color: {{ color | split: ' ' | last | handle }};{%- endif -%}
                                            {%- if has_metaobject -%}--swatch--background-color: {{ background_color }};{%- endif -%}
                                            {% comment %} {%- if has_metaobject and metaobject_color == blank -%}--swatch--background-color: {{ background_color }};{%- endif -%} {% endcomment %}
                                            {%- if background_image != blank -%}--swatch--background: url({{ background_image }});{%- endif -%}"
                                            data-title="{{ color | handle }}"
                                            data-variant-id="{{ variant.id }}"
                                            data-variant-img="{{ variant.image.src | product_img_url: '800x' }}"
                                        {% else %}
                                          class="{{ class_swatch }} color-swacth-color--{{ color | handle }} swatch--unavailable"
                                        {% endif %}
                                    ></span>
                                    <span class="{{ class_tooltip }}">{{ color | escape }}</span>
                                </div>
                            </li>
                        {%- else -%}
                            {%- if count == number_limit -%}
                                <li class="group-swatch " style="--gap-x: 0.5rem; display: none">
                            {%- endif -%}
                                <div class="swatch-item relative">
                                    <div class="swatch-wrapper">
                                        <span
                                            {% if enable_variant_image %}
                                            class="{{ class_swatch }} color-swacth-color--{{ color | handle }}"
                                            style="{%- if swatch_type == 'color' -%}--swatch--background-color: {{ color | split: ' ' | last | handle }};{%- endif -%}
                                                {%- if has_metaobject and metaobject_color != blank -%}--swatch--background-color: {{ background_color }};{%- endif -%}
                                                {%- if background_image != blank -%}--swatch--background: url({{ background_image }});{%- endif -%}"
                                                data-title="{{ color | handle }}"
                                                data-variant-id="{{ variant.id }}"
                                                data-variant-img="{{ variant.image.src | product_img_url: '800x' }}"
                                            {% else %}
                                            class="{{ class_swatch }} color-swacth-color--{{ color | handle }} swatch--unavailable"
                                            {% endif %}
                                        ></span>
                                        <span class="{{ class_tooltip }}">{{ color | escape }}</span>
                                    </div>
                                </div>
                            {%- if forloop.last -%}
                                </li>
                            {%- endif -%}
                        {%- endif -%}
                        {%- assign count = count | plus : 1 -%}
                        {%- capture tempList -%}
                            {{- colorList | append: color | append: '|' -}}
                        {%- endcapture -%}
                        {%- assign colorList = tempList -%}
                    {%- endunless -%}
                {%- endfor -%}
                {%- if count > number_limit -%}
                    <li class="item-swatch-more item"><button type="button" class="number-showmore t-button cursor-pointer" title="More Color"><span>+</span> <span class="text-number">{{ count | minus : number_limit }}</span></button></li>
                {%- endif -%}
            </ul>
        </color-swatch>
    </div>
{%- endif -%}
