{%- doc -%}
  Renders a default variant picker, used to display the variant picker in the variants block.

  @param {object} product_resource - The product object.
  @param {object} [block] - The block object
{%- enddoc -%}

{%- liquid
    assign bl_stts = block.settings
    assign custom_fields = product.metafields.custom.combined_products_listing
-%}

{% unless product_resource.has_only_default_variant %}
  {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag: preload: true }}
  {{ 'component-swatch-input.css' | asset_url | stylesheet_tag: preload: true }}
  {{ 'component-swatch.css' | asset_url | stylesheet_tag: preload: true }}
  
  <variant-selects
    id="variant-selects-{{ block.id }}"
    class="variant-selects spacing-style variant-selects--{{ bl_stts.alignment }}"
    style="{% render 'spacing-style', settings: bl_stts %}"
    data-section="{{ block.id }}"
    data-section-id="{{ block.id }}"
    data-product-id="{{ product_resource.id }}"
    data-block-id="{{ block.id }}"
    data-product-url="{{ product_resource.url }}"
    ref="mainVariantSelects"
    {% if product.id == product_resource.id %}
      data-template-product-match="true"
    {% endif %}
    {{ block.shopify_attributes }}
    {% if request.visual_preview_mode %}
      data-shopify-visual-preview
    {% endif %}
    style="
      --detail-variant-bg: {{ detail_variant_bg }};
    "
  >
    {%- for product_option in product_resource.options_with_values -%}
      {%- liquid
        assign variant_style = 'pills'
        assign product_swatch_option = settings.swatch | downcase
        assign swatch_type = settings.swatch_type
        assign option_name = product_option.name | downcase
        assign is_color = true

        assign variant_style = 'swatch'
      -%}
        <fieldset  class="js product-form__input variant-option variant-option--buttons{% if is_color %} product-form__input--swatch variant-option--swatches{% else %} product-form__input--pill variant-option--{{ bl_stts.variant_button_width }}{% endif %}" data-option-index="{{ forloop.index0 }}" data-step="{{ forloop.index0 }}">
          {% if product_swatch_option contains option_name %}
          <div class="has-perk color-comparison w-full flex justify-between items-center">
          {% endif %}
          <legend class="form__label">
            {{ product_option.name | escape | prepend: 'Choose ' }}:
            <span data-selected-value>
              {{- product_option.selected_value -}}
            </span>
          </legend>
          {% if product_swatch_option contains option_name %}
          </div>
          {% endif %}
          {% render 'product-variant-options',
            option: product_option,
            block: block,
            variant_style: variant_style,
            swatch_type: swatch_type,
            is_color: is_color,
            index: forloop.index0,
            sbs_variant_picker: true
          %}
        </fieldset>
    {%- endfor -%}

    {% if show_customization_option and require_item != blank %}
      <div class="product-form__input product-step__input" data-step="{{ forloop_index }}">
        <div class="form__label">
          {{ require_item }}:
        </div>
        <textarea id="{{ require_item | handleize | append: '-' | append: product_resource.id }}" class="text-area form-input not-change" rows="6" name="properties[{{ require_item }}]"></textarea>
      </div>
    {% endif %}

    <script type="application/json" data-selected-variant>
      {{ product_resource.selected_or_first_available_variant | json }}
    </script>
    <script data-all-variants>
      {{ product.variants | json }}
    </script>
  </variant-selects>
{% endunless %}

<script>
  window.product_inventory_policy_array_{{ product.id }} = {
    {% for variant in product.variants %}
      '{{ variant.id }}': '{{ variant.inventory_policy }}',
    {%endfor%}
  };
</script>

{% stylesheet %}
  .variant-selects {
    width: 100%;
  }

  .variant-selects__form {
    display: flex;
    flex-direction: column;
    gap: var(--padding-lg);
    width: 100%;
  }

  .variant-selects[data-shopify-visual-preview] {
    min-width: 300px;
    padding-inline-start: max(4px, var(--padding-inline-start));
  }

  .variant-option {
    margin-block-end: var(--margin-xl);
    --options-border-radius: var(--variant-selects-button-radius);
    --options-border-width: var(--variant-selects-button-border-width);
    --variant-option-padding-inline: var(--padding-md);
  }

  .variant-option--swatches {
    --options-border-radius: var(--variant-selects-swatch-radius);

    width: 100%;
  }

  .variant-option--swatches-disabled {
    pointer-events: none;
    cursor: not-allowed;
  }

  .variant-option--buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-sm);
    padding: 0;
    border: none;
  }

  .variant-option--buttons legend {
    padding: 0;
    margin-block-end: var(--margin-xs);
  }

  .variant-option__swatch-value {
    padding-inline-start: var(--padding-xs);
    color: rgb(var(--color-foreground-rgb) / var(--opacity-70));
  }

  .variant-option__button-label {
    --variant-selects-stroke-color: var(--color-variant-border);

    display: flex;
    flex: 0 0 calc(3ch + 1.3em);
    align-items: center;
    position: relative;
    padding-block: var(--padding-sm);
    padding-inline: var(--padding-lg);
    border: var(--style-border-width) solid var(--color-variant-border);
    border-radius: var(--options-border-radius);
    border-width: var(--options-border-width);
    overflow: clip;
    justify-content: center;
    min-height: calc(3ch + 1.3em);
    min-width: fit-content;
    white-space: nowrap;
    background-color: var(--color-variant-background);
    color: var(--color-variant-text);
    transition: background-color var(--animation-speed) var(--animation-easing),
      border-color var(--animation-speed) var(--animation-easing);

    &:hover {
      background-color: var(--color-variant-hover-background);
      border-color: var(--color-variant-hover-border);
      color: var(--color-variant-hover-text);
    }

    @media screen and (min-width: 750px) {
      padding: var(--padding-xs) var(--variant-option-padding-inline);
    }
  }

  .variant-option__button-label__text {
    text-align: left;
    text-wrap: auto;
  }

  .variant-option--equal-width-buttons {
    --variant-min-width: clamp(44px, calc(var(--variant-option-padding-inline) * 2 + var(--variant-ch)), 100%);

    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--variant-min-width), 1fr));

    .variant-option__button-label {
      min-width: var(--variant-min-width);
    }

    .variant-option__button-label__text {
      text-align: center;
      text-wrap: balance;
    }
  }

  .variant-option__button-label:has(:focus-visible) {
    --variant-selects-stroke-color: var(--color-foreground);

    border-color: var(--color-foreground);
    outline: var(--focus-outline-width) solid var(--color-foreground);
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__button-label--has-swatch {
    --focus-outline-radius: var(--variant-selects-swatch-radius);
    padding: 0;
    border: none;
    display: block;
    flex-basis: auto;
    min-height: auto;
  }

  .variant-option__button-label:has(:checked) {
    color: var(--color-selected-variant-text);
    background-color: var(--color-selected-variant-background);
    border-color: var(--color-selected-variant-border);
    transition: background-color var(--animation-speed) var(--animation-easing),
      border-color var(--animation-speed) var(--animation-easing);

    &:hover {
      background-color: var(--color-selected-variant-hover-background);
      border-color: var(--color-selected-variant-hover-border);
      color: var(--color-selected-variant-hover-text);
    }
  }

  .variant-option__button-label:has([data-option-available='false']) {
    color: rgb(var(--color-variant-text-rgb) / var(--opacity-60));
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch {
    --focus-outline: var(--focus-outline-width) solid rgb(var(--color-foreground-rgb) / var(--opacity-35-55));
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label:has(:focus-visible) .swatch {
    --focus-outline: var(--focus-outline-width) solid currentcolor;
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label:has(:focus-visible) {
    outline: none;
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover {
    outline: none;
  }

  .variant-option__button-label--has-swatch:hover {
    outline: var(--focus-outline-width) solid rgb(var(--color-foreground-rgb) / var(--opacity-35-55));
    outline-offset: var(--focus-outline-offset);
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:has(:checked) {
    --focus-outline: none;
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:has(:checked) .swatch {
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__button-label--has-swatch:has(:checked) {
    --focus-outline: var(--focus-outline-width) solid var(--color-foreground);
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  /* This triggers iOS < 16.4. The outline bug is not recognized as a lack of @supports */
  @supports not (background-color: rgb(from red 150 g b / alpha)) {
    /** There is a bug in safari < 16.4 that causes the outline to not follow the elements border radius. This is a workaround. **/
    .variant-option__button-label--has-swatch:has(:checked),
    .variant-option__button-label:has(:focus-visible) .swatch,
    .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch {
      outline: none;
      position: relative;
      overflow: visible;
    }

    .variant-option__button-label--has-swatch:has(:checked)::after,
    .variant-option__button-label:has(:focus-visible) .swatch::after,
    .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch::after {
      content: '';
      position: absolute;
      inset: calc(-1 * var(--focus-outline-offset));
      border: var(--focus-outline);
      border-radius: var(--focus-outline-radius, 50%);
      background-color: transparent;
      display: inherit;
    }
  }

  .variant-option__button-label:has([data-option-available='false']):has(:checked) {
    --variant-selects-stroke-color: rgb(var(--color-variant-text-rgb) / var(--opacity-60));

    background-color: inherit;
    color: rgb(var(--color-variant-text-rgb) / var(--opacity-60));
    border-color: var(--color-selected-variant-border);
  }

  .variant-option__button-label input,
  .variant-option--images input {
    /* remove the checkbox from the page flow */
    position: absolute;

    /* set the dimensions to match those of the label */
    inset: 0;

    /* hide it */
    opacity: 0;
    margin: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .variant-option__button-label svg {
    position: absolute;
    top: 0;
    left: 0;
    cursor: pointer;
    pointer-events: none;
    stroke-width: var(--style-border-width);
    stroke: var(--variant-selects-stroke-color);
  }

  .variant-option__select-wrapper {
    display: flex;
    position: relative;
    border: var(--inputs-border-width) solid var(--color-border);
    border-radius: var(--inputs-radius);
    align-items: center;
    margin-top: var(--margin-2xs);
    overflow: clip;
    transition: background-color var(--animation-speed) var(--animation-easing),
      border-color var(--animation-speed) var(--animation-easing);
  }

  .variant-option__select-wrapper:has(.swatch) {
    --variant-selects-swatch-width: 20px;
    --variant-selects-swatch-height: 20px;
  }

  .variant-option__select-wrapper:hover {
    border-color: var(--color-variant-hover-border);
  }

  .variant-option__select:focus-visible {
    outline: var(--focus-outline-width) solid currentcolor;
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__select {
    padding-block: var(--padding-md);
    padding-inline: var(--padding-lg) calc(var(--padding-lg) + var(--icon-size-2xs));
    appearance: none;
    border: 0;
    width: 100%;
    margin: 0;
    cursor: pointer;
  }

  .variant-option__select-wrapper .icon {
    position: absolute;
    right: var(--padding-md);
    top: 50%;
    transform: translateY(-50%);
    width: var(--icon-size-2xs);
    height: var(--icon-size-2xs);
    pointer-events: none;
  }

  .variant-option__select-wrapper .swatch {
    position: absolute;
    top: 50%;
    left: var(--padding-md);
    transform: translateY(-50%);
  }

  .variant-selects--center,
  .variant-selects--center .variant-option,
  .variant-selects--center .swatch-custom ul {
    text-align: center;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .variant-selects--right,
  .variant-selects--right .variant-option,
  .variant-selects--right .swatch-custom ul {
    text-align: right;
    justify-content: right;
  }

  .swatch-custom {
      margin-bottom: 11px;
  }

  .swatch-custom ul {
      column-gap: 10px;
  }

  .swatch-custom .item-custom--image .item-custom--inner {
      display: block;
      width: var(--swatch--size);
      height: var(--swatch--size);
      cursor: pointer;
      border-radius: var(--swatch--border-radius);
      text-align: center;
      font-size: 0;
      letter-spacing: 0;
      position: relative;
      background-size: cover;
  }
{% endstylesheet %}
