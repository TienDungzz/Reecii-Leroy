{% comment %}
  Renders a header search modal. Should be used with 'header.liquid'

  Accepts:
  - input_id: {String} Id for the search input element (required)

  Usage:
  {% render 'header-search', input_id: 'My-Id'%}
{% endcomment %}

{%- liquid
  assign search_type = settings.search_type

  if search_type == 'full'
    assign details_wrapper = 'details-modal'
    assign details_element = 'details'
    assign details_summary = 'summary'
  else
    assign details_wrapper = 'div'
    assign details_element = 'div'
    assign details_summary = 'button'
  endif
-%}

<div
  class="header-block grid__itemblock{% if class != blank %} {{ class }}{% endif %}"
>
  <{{ details_wrapper }} class="header__search">
    <{{ details_element }}>
      {% if search_type == 'drawer' %}
        <side-drawer-opener data-side-drawer="#Drawer-Search">
      {% endif %}
        <{{ details_summary }}
          class="header__icon header__icon--search header__icon--summary link focus-inset modal__toggle"
          aria-haspopup="dialog"
          aria-label="{{ 'content.search' | t }}"
        >
          <span class="svg-wrapper">
            {{- 'icon-search.svg' | inline_asset_content -}}
          </span>
        </{{ details_summary }}>
      {% if search_type == 'drawer' %}
        </side-drawer-opener>
      {% endif %}
      {%- if search_type == 'full' -%}
        <div
          class="search-modal search-modal--{{ search_type }} modal__content"
          role="dialog"
          aria-modal="true"
          aria-label="{{ 'content.search' | t }}"
        >
          <div class="modal-overlay"></div>
          <div
            class="search-modal__content{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} search-modal__content-top{% else %} search-modal__content-bottom{% endif %}"
            tabindex="-1"
          >
            {%- if settings.predictive_search_enabled -%}
              <predictive-search class="search-modal__form" data-loading-text="{{ 'accessibility.loading' | t }}">
            {%- else -%}
              <search-form class="search-modal__form">
            {%- endif -%}
            <form action="{{ routes.search_url }}" method="get" role="search" class="search search-modal__form">
              <div class="predictive-search--center">
                <div class="field">
                  <button class="search__button field__button" aria-label="{{ 'content.search' | t }}">
                    <span class="svg-wrapper">
                      {{- 'icon-search.svg' | inline_asset_content -}}
                    </span>
                  </button>
                  <input
                    class="search__input field__input"
                    id="{{ input_id }}"
                    type="search"
                    name="q"
                    value="{{ search.terms | escape }}"
                    placeholder="{{ 'content.search' | t }}"
                    {%- if settings.predictive_search_enabled -%}
                      role="combobox"
                      aria-expanded="false"
                      aria-owns="predictive-search-results"
                      aria-controls="predictive-search-results"
                      aria-haspopup="listbox"
                      aria-autocomplete="list"
                      autocorrect="off"
                      autocomplete="off"
                      autocapitalize="off"
                      spellcheck="false"
                    {%- endif -%}
                  >
                  <label class="field__label" for="{{ input_id }}">{{ 'content.search' | t }}</label>
                  <input type="hidden" name="options[prefix]" value="last">
                  <button
                    type="reset"
                    class="reset__button field__button{% if search.terms == blank %} hidden{% endif %}"
                    aria-label="{{ 'content.clear_search_term' | t }}"
                  >
                    <span class="svg-wrapper">
                      {{- 'icon-close.svg' | inline_asset_content -}}
                      {% comment %} {{- 'icon-reset.svg' | inline_asset_content -}} {% endcomment %}
                    </span>
                  </button>
                  {% comment %}
                    <button
                      type="button"
                      class="search-modal__close-button modal__close-button link link--text focus-inset"
                      aria-label="{{ 'accessibility.close' | t }}"
                    >
                      <span class="svg-wrapper">
                        {{- 'icon-close.svg' | inline_asset_content -}}
                      </span>
                    </button>
                  {% endcomment %}
                </div>
              </div>

              {%- if settings.predictive_search_enabled -%}
                <div
                  class="predictive-search predictive-search--header predictive-search--center cus-scrollbar"
                  tabindex="-1"
                  data-predictive-search
                >

                  {% render 'predictive-search-empty-state', shadow_opacity: 0.1, products_test_id: products_test_id %}
                </div>

                <span class="predictive-search-status visually-hidden" role="status" aria-hidden="true"></span>
              {%- endif -%}
            </form>
            {%- if settings.predictive_search_enabled -%}
              </predictive-search>
            {%- else -%}
              </search-form>
            {%- endif -%}
          </div>
        </div>
      {%- else -%}
        {%- render 'predictive-search-drawer' -%}
      {%- endif -%}
    </{{ details_element }}>
  </{{ details_wrapper }}>
</div>

{% comment %}
  <side-drawer-opener class="toggle-sidebar" data-side-drawer="#Drawer-Blog-Sidebar">
    <button class="button--drawer focus-inset">
      <span class="svg-wrapper">
        {% render 'icon-sidebar' %}
      </span>
    </button>
  </side-drawer-opener>
{% endcomment %}
