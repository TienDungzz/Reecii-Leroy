{%- liquid
  assign sec_stts = section.settings
  assign sec_id = section.id

  assign media_width_desktop = '100vw'
  assign media_width_mobile = '100vw'
  assign sizes = '(min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile

  assign columns_desktop = sec_stts.columns_desktop
  assign columns_tablet = 2
  if columns_desktop == 1
    assign columns_tablet = 1
  elsif columns_desktop >= 4
    assign columns_tablet = 3
  endif

  assign columns_mobile = sec_stts.columns_mobile

  assign scroll_reveal = settings.animations_reveal_on_scroll
-%}

{%- capture class_content -%}
  sec-tab__row grid-layout lg:grid-layout--{{ columns_desktop }} md:grid-layout--{{ columns_tablet }} sm:grid-layout--{{ columns_mobile }}
{%- endcapture -%}

{%- capture style_content -%}
  --grid-desktop-horizontal-spacing: {{ sec_stts.content_horizontal_gap }}px; --grid-desktop-vertical-spacing: {{ sec_stts.content_vertical_gap }}px;
  --grid-mobile-horizontal-spacing: {{ sec_stts.content_horizontal_gap | times: 0.5 }}px; --grid-mobile-vertical-spacing: {{ sec_stts.content_vertical_gap | times: 0.5 }}px;
{%- endcapture -%}

{%- capture style_tab_active -%}
  --gap: {{ sec_stts.button_gap }}px;
  --color-tab-active: {{ sec_stts.color_tab_active }};
  --background-tab-active: {{ sec_stts.background_tab_active }};
{%- endcapture -%}

<div
  class="section section--{{ sec_stts.section_width }} color-{{ sec_stts.color_scheme }}"
  style="{% render 'spacing-style', settings: sec_stts %}"
>
  <tabs-component class="sec-tab w-full flex flex-column" style="--gap-y: {{ sec_stts.rows_gap }}px;">
    {%- assign alignment_header = sec_stts.button_alignment | replace: 'left', 'start' | replace: 'right', 'end' | prepend: 'justify-' -%}
    <div
      class="sec-tab__header relative w-full flex flex-wrap hide-scrollbar-mobile {{ alignment_header }} max-sm:justify-start"
      style="{{ style_tab_active }}"
    >

       {%- capture labels -%}
        {%- for block in section.blocks -%}
          {{ block.settings.title_header }}
          {%- unless forloop.last -%}
            ,
          {%- endunless -%}
        {%- endfor -%}
      {%- endcapture -%}

      {%- render 'tab-header-item',
        settings: sec_stts,
        id: sec_id,
        labels: labels,
        splitting_text: true,
        splitting_text_by: "chars",
        class: "tab-header-item"
      -%}
    </div>
    <div class="sec-tab__content">
      {%- for block in section.blocks -%}
        <div
          class="sec-tab__content-wrapper tabs-component-content {{ sec_stts.alignment }}{% if forloop.first %} --active{% endif %}"
          id="tabs-{{ sec_id }}-{{ forloop.index }}"
        >
          {%- unless forloop.first -%}
            <template>
          {%- endunless -%}
          <div class="{{ class_content }}" style="{{ style_content }}">
            {%- for link in block.settings.menu.links -%}
              {%- liquid
                assign base_name = link.title | handle | downcase | replace: ' ', '-'
                assign extensions = 'png' | split: ','
              -%}

              <div
                class="tab-item flex flex-column{% if scroll_reveal %} scroll-trigger animate--slide-in{% endif %}"
                style="
                   --gap-y: {{ sec_stts.content_vertical_gap | times: 0.5 }}px;
                  {% if scroll_reveal %}
                    --animation-order: {{ forloop.index }};
                  {% endif %}
                "
              >
                <a href="{{ link.url }}" class="tab-item__image">
                  {% for ext in extensions %}
                    {% assign filename = base_name | append: '.' | append: ext | file_url %}
                    <img
                      srcset="{{ filename }}"
                      alt="{{ link.title }}"
                      width="100%"
                      height="auto"
                      sizes="{{ sizes }}"
                      style="display:none;"
                      onload="this.style.display='block';"
                      onerror="this.remove();"
                      {%- if settings.enable_lazyload %}
                        loading="lazy"
                      {% endif -%}
                    >
                  {% endfor %}
                </a>
                <div class="tab-item__content">
                  <a href="{{ link.url }}" class="link link--text body-m-font-size subheading">{{ link.title }}</a>
                </div>
              </div>
            {%- endfor -%}
          </div>
          {%- unless forloop.first -%}
            </template>
          {%- endunless -%}
        </div>
      {%- endfor -%}
    </div>
  </tabs-component>
</div>

{%- stylesheet -%}
{%- endstylesheet -%}

{% schema %}
{
  "name": "Tab section",
  "class": "tab-group",
  "disabled_on": {
    "groups": ["header"]
  },
  "max_blocks": 6,
  "settings": [
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:content.section_size",
      "options": [
        {
          "value": "page-width",
          "label": "Page"
        },
        {
          "value": "full-width",
          "label": "Full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "t:sections.featured-collection.settings.columns_desktop.label"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "t:sections.featured-collection.settings.columns_mobile.label",
      "options": [
        {
          "value": "1",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__2.label"
        }
      ]
    },
    {
      "type": "range",
      "id": "rows_gap",
      "label": "Vertical gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "text_alignment",
      "id": "alignment",
      "label": "t:settings.alignment",
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:content.buttons"
    },
    {
      "type": "text_alignment",
      "id": "button_alignment",
      "label": "t:settings.alignment",
      "default": "center"
    },
    {
      "type": "range",
      "id": "button_gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "select",
      "id": "style_class",
      "label": "t:settings.style",
      "options": [
        {
          "value": "button",
          "label": "t:options.primary"
        },
        {
          "value": "button-secondary",
          "label": "t:options.secondary"
        },
        {
          "value": "link",
          "label": "t:options.link"
        }
      ],
      "default": "button"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:settings.type",
      "visible_if": "{{ section.settings.style_class == 'button' }}",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "outline",
          "label": "Outline"
        }
      ],
      "default": "default"
    },
    {
      "type": "checkbox",
      "id": "link_underline",
      "label": "Underline",
      "default": false,
      "visible_if": "{{ section.settings.style_class == 'link' }}"
    },
    {
      "type": "color",
      "id": "color_tab_active",
      "label": "Color active",
      "alpha": true,
      "default": "#fff"
    },
    {
      "type": "color",
      "id": "background_tab_active",
      "label": "Background active",
      "alpha": true,
      "default": "#E1732C"
    },
    {
      "type": "header",
      "content": "t:names.content"
    },
    {
      "type": "range",
      "id": "content_horizontal_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "content_vertical_gap",
      "label": "Vertical gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "t:content.appearance"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "multitab-image-row",
      "name": "Row",
      "settings": [
        {
          "type": "text",
          "id": "title_header",
          "label": "Title"
        },
        {
          "type": "link_list",
          "id": "menu",
          "label": "Menu"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Multitab image",
      "blocks": [
        {
          "type": "multitab-image-row"
        }
      ]
    }
  ]
}
{% endschema %}
