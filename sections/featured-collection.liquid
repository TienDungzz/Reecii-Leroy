{{ 'template-collection.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- if section.settings.quick_add != 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- liquid
  assign sec_stts = section.settings

  assign products_to_display = sec_stts.collection.all_products_count

  assign max_tiems = sec_stts.products_to_show

  if sec_stts.collection.all_products_count > max_tiems
    assign products_to_display = max_tiems
    assign more_in_collection = true
  endif

  assign columns_mobile_int = sec_stts.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if sec_stts.swipe_on_mobile and products_to_display > columns_mobile_int
    assign show_mobile_slider = true
  endif

  assign show_desktop_slider = false
  if sec_stts.enable_desktop_slider and products_to_display > sec_stts.columns_desktop
    assign show_desktop_slider = true
  endif

  assign columns_tablet = 2
  if sec_stts.columns_desktop == 1
    assign columns_tablet = 1
  endif

  assign section_collections = sec_stts.collection.products | default: (1..max_tiems)
-%}

<div class="color-{{ sec_stts.color_scheme }} gradient pos-relative z-index-0">
  <div
    class="collection{% if sec_stts.quick_add == 'bulk' %} collection-quick-add-bulk{% endif %}{% if sec_stts.full_width %} collection--full-width{% endif %} spacing"
    id="collection-{{ section.id }}"
    data-id="{{ section.id }}"
    style="
      --p-spacing-t: {{ sec_stts.padding_top }}px;
      --p-spacing-b: {{ sec_stts.padding_bottom }}px;
    "
  >
    <div class="section-global__header">
      {%- content_for 'block', type: '_section-header', id: 'section-header' -%}
    </div>

    {% capture list_items %}
     {% for product in section_collections limit: max_tiems %}
        <li id="Slide-{{ block.id }}-{{ forloop.index }}" class="grid__item{% if show_mobile_slider or show_desktop_slider or show_tablet_slider %} slider__slide{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
          {% if settings.animations_reveal_on_scroll %} data-cascade style="--animation-order: {{ forloop.index }};"{% endif %}
        >
            {% content_for "block", type: "card-product-flex", id: "product-slide-item", closest.product: product %}
        </li>
      {% endfor %} 
    {% endcapture %}

    <div class="section-global__content">
      {% case sec_stts.layout_type %}
        {% when 'grid' %}
          <ul
            id="Grid-{{ section.id }}"
            data-id="{{ section.id }}"
            class="grid product-grid contains-card contains-card--product{% if settings.card_style == 'standard' %} contains-card--standard{% endif %} grid--{{ block.settings.columns_desktop }}-col-desktop grid--{{ columns_tablet }}-col-tablet-down grid--{{ sec_stts.columns_mobile }}-col-mobile"
            role="list"
            aria-label="{{ 'general.grid.name' | t }}"
            style="--grid-desktop-horizontal-spacing: {{ sec_stts.columns_gap }}px; --grid-desktop-vertical-spacing: {{ sec_stts.rows_gap }}px;"
          >
            {{ list_items }}
          </ul>

        {% when 'carousel' %}
          {% comment %}
            {% render 'resource-list-carousel',
              ref: 'resourceListCarousel',
              slides: list_items_array,
              slide_count: max_items,
              settings: sec_stts,
              section_id: section.id
            %}
          {% endcomment %}

          <swiper-component>
            <div class="swiper">
              <ul id="Slider-{{ section.id }}" data-id="{{ section.id }}" class="swiper-wrapper">
                {%- for variable in array reversed limit: number offset: number -%}
                {%- endfor -%}
              </ul>
            </div>
          </swiper-component>
          {% comment %}
            {% when 'editorial' %}
              {% render 'editorial-product-grid', items: list_items_array %}
          {% endcomment %}
      {% endcase %}
    </div>

    {%- if sec_stts.show_view_all and more_in_collection -%}
      <div class="center collection__view-all{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        <a
          href="{{ sec_stts.collection.url }}"
          class="{% if sec_stts.view_all_style == 'link' %}link underlined-link{% elsif sec_stts.view_all_style == 'solid' %}button{% else %}button button--secondary{% endif %}"
          aria-label="{{ 'sections.featured_collection.view_all_label' | t: collection_name: sec_stts.collection.title | escape }}"
        >
          {{ 'sections.featured_collection.view_all' | t }}
        </a>
      </div>
    {%- endif -%}
    {% if sec_stts.image_shape == 'arch' %}
      {{ 'mask-arch.svg' | inline_asset_content }}
    {%- endif -%}
  </div>
</div>

{%- if sec_stts.quick_add != 'none' -%}
  {%- liquid
    assign files = 'product-form.js'

    if sec_stts.quick_add == 'standard'
      assign files = files | append: ', quick-add.js'
    endif

    if sec_stts.quick_add == 'bulk'
      assign files = files | append: ', quick-add-bulk.js, quantity-popover.js, price-per-item.js, quick-order-list.js'
    endif

    assign files = files | split: ', '
    render 'theme-loader', files: files
  -%}
{%- endif -%}

{% schema %}
{
  "name": "t:sections.featured-collection.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer", "custom.popup"]
  },
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.featured-collection.settings.collection.label"
    },
    {
      "type": "select",
      "id": "layout_type",
      "label": "t:settings_schema.global.settings.type.label",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "editorial",
          "label": "Editorial"
        }
      ],
      "default": "grid"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 25,
      "step": 1,
      "default": 4,
      "label": "t:sections.featured-collection.settings.products_to_show.label"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "t:sections.featured-collection.settings.columns_desktop.label"
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8,
      "visible_if": "{{ section.settings.layout_type == 'grid' or section.settings.layout_type == 'carousel' }}"
    },
    {
      "type": "range",
      "id": "rows_gap",
      "label": "Vertical gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8,
      "visible_if": "{{ section.settings.layout_type == 'grid'}}"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "t:sections.featured-collection.settings.full_width.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "t:sections.featured-collection.settings.show_view_all.label"
    },
    {
      "type": "select",
      "id": "view_all_style",
      "label": "t:sections.featured-collection.settings.view_all_style.label",
      "options": [
        {
          "value": "link",
          "label": "t:sections.featured-collection.settings.view_all_style.options__1.label"
        },
        {
          "value": "outline",
          "label": "t:sections.featured-collection.settings.view_all_style.options__2.label"
        },
        {
          "value": "solid",
          "label": "t:sections.featured-collection.settings.view_all_style.options__3.label"
        }
      ],
      "default": "solid"
    },
    {
      "type": "checkbox",
      "id": "enable_desktop_slider",
      "label": "t:sections.featured-collection.settings.enable_desktop_slider.label",
      "default": false
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "info": "t:sections.all.colors.has_cards_info",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.featured-collection.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "t:sections.featured-collection.settings.columns_mobile.label",
      "options": [
        {
          "value": "1",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__2.label"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": false,
      "label": "t:sections.featured-collection.settings.swipe_on_mobile.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.name"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [{ "type": "@theme" }, { "type": "@app" }],
  "presets": [
    {
      "name": "Featured collection: Grid",
      "settings": {
        "products_to_show": 8
      },
      "blocks": {
        "section-header": {
          "type": "_section-header",
          "static": true,
          "settings": {
            "padding_bottom": 16
          },
          "blocks": {
            "heaidng": {
              "type": "_collection_title",
              "settings": {
                "text": "<h2>{{ closest.collection.title }}</h2>"
              }
            }
          },
          "block_order": ["heaidng"]
        },
        "product-slide-item": {
          "type": "card-product-flex",
          "name": "Product card",
          "static": true,
          "settings": {
            "product": "{{ closest.product }}"
          },
          "blocks": {
            "media": {
              "type": "card-product-media-flex",
              "name": "Group: Product media",
              "settings": {
                "product": "{{ closest.product }}",
                "image_ratio": "adapt",
                "show_secondary_image": true,
                "enable_quick_add": true
              }
            },
            "spacer": {
              "type": "spacer",
              "settings": {
                "spacer_height": 6
              }
            },
            "vendor": {
              "type": "card-product-vendor-flex",
              "settings": {
                "product": "{{ closest.product }}"
              }
            },
            "title": {
              "type": "card-product-title-flex",
              "settings": {
                "product": "{{ closest.product }}"
              }
            },
            "price": {
              "type": "card-product-price-flex",
              "settings": {
                "product": "{{ closest.product }}"
              }
            },
            "variant": {
              "type": "card-product-variant-flex",
              "settings": {
                "product": "{{ closest.product }}"
              }
            }
          },
          "block_order": ["media", "spacer", "vendor", "title", "price", "variant"]
        }
      }
    }
  ]
}
{% endschema %}
